# Basis Index Mismatch: Mapping McAllister's Divisor Basis to CYTools

## Executive Summary

We are trying to reproduce V_string = 4711.83 from McAllister et al. arXiv:2107.09064 for the primal polytope (h11=214, h21=4). We have all the data but get V_string = 17901 instead (280% error). The dual polytope (h11=4) works with 0.36% error. The problem is mapping between McAllister's basis indices and CYTools divisor indices.

---

## The Formula

```
V_string = (1/6) κ_ijk t^i t^j t^k
```

Where:
- κ_ijk = triple intersection numbers of divisors D_i, D_j, D_k
- t^i = Kähler moduli (2-cycle volumes)
- Indices i,j,k run from 0 to h11-1 = 213

---

## Results

| Polytope | h11 | V_computed | V_target | Error |
|----------|-----|------------|----------|-------|
| Dual | 4 | 4694.96 | 4711.83 | 0.36% ✓ |
| Primal | 214 | 17901.22 | 4711.83 | 280% ✗ |

The ratio V_computed/V_target = 3.80 ≈ 4 (not related to frame conversion).

---

## Complete Data

### Target Volume
```
4711.829675204889
```

### basis.dat (214 divisor indices)
```
1,2,3,4,5,6,7,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218
```

**Note:** Indices 8,9,10,17 are MISSING. Skips from 7 to 11, and 16 to 18.

### kahler_param.dat (214 t values)
```
0.7382695471530951,10.467851782744788,0.46998321457721204,68.48967675480708,108.27404383857265,91.6590251715952,149.54559873715698,0.008675912228966354,2.1879085583028655,2.3998092035748186,4.754858616516685,5.258883114396667,9.27861468426363,10.660570227684047,14.143012340824498,16.63637172509607,20.90476621823882,26.319070651980383,5.347234338097735,27.989192369368084,36.827804418946926,36.842400082684435,51.45052723179151,46.01798034938929,-0.2165843659034863,67.34011436880155,57.06737862022965,87.37628729686821,67.67185852707098,45.135114775773616,71.98004153077403,111.35850706660767,39.3538524746196,59.27521541942252,67.38283900882925,22.125080317847164,35.87857118688305,115.14354376365736,70.33790459178181,121.85587025492532,73.99932704486491,19.151751887078603,49.35729669491673,129.14257216601527,51.00153809054888,79.88859999534276,82.24773019051736,55.34348814271556,99.31290064230137,139.09346570446633,94.27928888120732,98.40405976511465,108.62574194961053,119.74819498888246,134.35811966485198,-2.340799592513349,-2.62943536689761,-2.7253125578395156,-1.3080370294715067,-4.604321668451803,-1.778179817697719,1.2408084433695876,-3.4390708118319253,-4.00713419693534,0.7832927986114555,5.433306125500167,-0.45076345715619937,-1.6647408058579458,-0.4285109154656084,-3.9052906431306837,-2.9314849528436753,4.859153722319661,10.598222902603538,0.9699289017701744,2.775452084462813,-2.1911677344719465,1.1836309866455963,-3.1581740916467425,0.679871102594916,10.721637033178467,17.260541801781983,4.038175297734085,7.721256746642666,2.095400095712648,-2.328154858609196,4.894024275494473,-1.3766378781442654,5.114605715298239,19.890046686403366,5.034694766640257,5.054634391200295,24.916771196841182,8.80185444613852,14.957743499659955,7.618875035014298,2.4769349667935785,-0.8235982584901649,10.779565561889001,1.8691660469880844,14.135881523563967,31.25206022700513,7.389204509497517,7.689083596004934,33.844858920406296,15.626338952621552,22.632946908178383,14.943605755399403,8.075383417249213,4.13789271278074,0.9190998634267089,20.676123583465085,8.78552513788145,26.002394991875917,46.500617110869825,12.07464719951372,13.425820976221019,43.8789567238191,23.998325750091624,32.4121681753968,23.603280289901704,0.6138082953414141,16.471497978616753,0.7605371871186435,11.355208460303402,7.24801205625954,3.7529273781983647,34.06948629058428,23.93182323309702,44.48538007826846,65.5563515933436,18.985326440794893,23.532731633384174,55.12577323541245,33.73811210607613,42.588994546716094,33.559589789188976,3.949359719397421,25.381001589713378,20.314810186914656,5.178789571786297,15.816485761692093,15.811286998893593,26.766580989014074,51.24190620632629,45.679342231156625,65.26687002822655,86.63230284619203,28.015012110178247,4.829744868328021,38.789701264408166,54.79081084561858,44.73188441977072,12.086369747693993,36.41000324336892,31.03538770448631,27.044659057949502,17.23875146240391,28.069611504822205,36.321964799032685,51.05003369129918,69.83760658554274,89.86196564008242,43.38536704968095,57.03420712305979,47.78178582105738,42.62500369434929,38.56305999484175,40.56822977549746,46.70556544597457,60.1319677171532,75.15468749717178,75.62412184391269,95.05542392489497,38.78360429578248,16.054657009012317,22.84472115449256,62.65111642615767,43.11892236006855,60.757302878045266,20.373782533573717,55.12799646671192,51.221128789553404,53.36142487240613,40.61073712661289,58.89517868990151,70.4445547193709,80.85668682382305,84.93582111900196,102.15083068564036,42.12932519764405,14.781755019369143,29.63867154338567,69.63824369760965,46.47127524981164,68.3231399788283,64.04607409014625,33.913304316133576,66.53213698946183,71.29090520123191,82.29123027845526,88.95590009994788,94.83704047077481,111.43596959130264,54.356041939822774,64.97482729152904,77.77815640716744,58.69799199199127,80.14773954979046,69.30203934865398,84.75747840948952,83.65644188242089,94.98428527336728,107.0873385471441,121.92894934515789
```

### heights.dat (219 values for triangulation)
```
0.0,0.0,0.0,519.7246416099571,410.02671313124796,-167.50280365278877,35.68030860466448,-215.09005976367465,504.4448565604682,453.0020329048181,489.6350547255566,386.75808332648535,477.01316144894787,322.89659112726935,464.77030967225,259.50303954752957,454.48426390508536,345.92368241453556,198.65210117025487,444.5388597267349,138.3752771771059,436.4908117692377,81.80535061342867,259.7406376444152,428.765436085455,26.061458889832725,422.80884196385915,-25.56844378788405,417.17462039565237,172.3761220677878,-75.93148214143491,413.4142168315818,-122.14793470392875,342.95626941294984,272.5803825110162,-112.11727997918499,-179.22814225966385,204.88844477146742,-83.84713421763017,276.41462440414494,135.47857941189218,-56.53922434167167,-190.25290739752742,213.11706449653764,-198.3503827411713,150.52586145905838,0.0,-72.680102503462,-205.87348266499313,17.778253915711346,-107.66315514644467,92.52163911414917,17.77825391571137,-144.02362820730218,-210.73239096145377,-13.14225134137351,-60.46030411311632,-101.6814455842709,-142.0018162006479,-178.83471518032817,435.85143147739313,420.75299386809724,369.2142930215051,407.26459037061187,352.5254820759814,303.90880027108557,395.0036340085414,338.8809310976897,286.87004405693614,240.21764739683258,384.3863298557604,330.6631171224677,325.8454592687522,279.2425460085083,272.16208577582887,221.69306781046632,178.04088282998,374.74144479795183,317.27400764648235,315.47585032416123,259.0664068495765,214.60206242005785,206.65657683675178,159.0517983753434,117.65074065027615,366.5939618622181,305.53245220753473,305.61185315142944,248.5431728448497,192.67679423487832,152.05983021834462,142.1854875596921,97.23390749748415,60.56652481293944,244.61829623804636,193.1954122069563,359.4403894223658,295.4863295210275,298.03853806953504,239.25684594923973,182.67208222536786,127.92872534443471,91.69274601417774,79.1786659942623,40.00255781518827,5.675912862979354,232.1630041459919,129.57723592119916,353.55867531101995,287.50101219259926,290.90393964314177,231.77177483471192,173.46072884091203,118.08041448079328,63.418797975788856,35.33667854519241,19.842399594593772,-14.383554207060882,-45.32815574371787,222.03864500109648,69.06134781085349,348.78297127952186,281.0631971551576,285.87335907544843,225.62164753430343,158.39671289412115,167.04704156736878,107.10061813024834,110.48792839340426,54.93790833371096,0.0,-17.52258423825079,-31.26392780075119,-62.15319461123062,-92.52504675180506,214.13952240746602,12.915632977454905,345.21998595620283,275.9931816762299,281.24038361185535,220.7681551986785,146.92246248326535,161.14674334355277,104.63772828510395,45.26624502435425,48.69658020423114,-2.751442214216739,-43.23897187974493,-66.60278981307071,-75.76903429325392,-107.6243301518333,-137.70172098951792,208.35940624193773,85.89217219380133,-38.08002288208245,278.63239807584665,217.13064799434855,140.24967067665034,157.3659431622972,100.5485039677645,45.11495166557683,-8.926418575590223,-5.3029195431985885,-48.49338990464001,-85.2081446680221,-117.86339542942875,-149.2818600305392,204.5780092943623,214.62316886272578,153.92792390507418,97.32831812271498,41.82355076755821,-7.614103107437052,-52.91959109260871,-90.93601247708042,-123.75243584769832,-126.8866820059718,-158.8982035806392,138.06557110206853,67.49748066466242,-28.598102501157523,-95.28103504580677,138.05893911418778,152.09363912715034,67.47465613705668,95.02150906016635,39.671817727357585,-9.630709845437398,-66.61686023685478,-55.539779683593316,-95.4332273097749,-132.86023835595677,-132.38478456579253,-166.61259865480483,75.15866651336854,-0.028046815542482624,-36.613953947176064,-103.1037096092661,75.15866651336815,93.40685073737063,37.6869611930398,-36.681271226595705,-11.269799563295365,-57.9538550071752,-98.39635358560102,-139.57082691474477,-137.29336704893245,-172.13726158405606,-30.31006589066466,-71.13410419460811,36.609241675148255,-30.31006589066461,-12.463998837879425,-71.14884218965031,-59.29708363382847,-108.23726331153462,-100.51310042560095,-139.85287080747486,-176.45408366510952
```

### points.dat (294 lattice points, 4D)
```
0,0,0,0
0,1,0,0
1,0,0,0
-15,-14,-6,-6
-3,-2,-6,6
-3,-2,6,-6
3,4,0,6
3,4,6,0
-14,-13,-6,-5
-14,-13,-5,-6
-13,-12,-6,-4
-13,-12,-4,-6
-12,-11,-6,-3
-12,-11,-3,-6
-11,-10,-6,-2
-11,-10,-2,-6
-10,-9,-6,-1
-10,-9,-4,-4
-10,-9,-1,-6
-9,-8,-6,0
-9,-8,0,-6
-8,-7,-6,1
-8,-7,1,-6
-7,-7,-3,-3
-7,-6,-6,2
-7,-6,2,-6
-6,-5,-6,3
-6,-5,3,-6
-5,-4,-6,4
-5,-4,-2,-2
-5,-4,4,-6
-4,-3,-6,5
-4,-3,5,-6
-2,-1,-5,6
-2,-1,-4,4
-2,-1,4,-4
-2,-1,6,-5
-1,-1,-3,3
-1,-1,3,-3
-1,0,-4,6
-1,0,-2,2
-1,0,2,-2
-1,0,6,-4
0,1,-3,6
0,1,6,-3
1,2,-2,6
1,2,0,2
1,2,2,0
1,2,6,-2
2,2,0,3
2,2,3,0
2,3,-1,6
2,3,0,4
2,3,4,0
2,3,6,-1
3,4,1,5
3,4,2,4
3,4,3,3
3,4,4,2
3,4,5,1
-13,-12,-5,-5
-12,-11,-5,-4
-12,-11,-4,-5
-11,-10,-5,-3
-11,-10,-4,-4
-11,-10,-3,-5
-10,-9,-5,-2
-10,-9,-4,-3
-10,-9,-3,-4
-10,-9,-2,-5
-9,-8,-5,-1
-9,-8,-4,-3
-9,-8,-4,-2
-9,-8,-3,-4
-9,-8,-3,-3
-9,-8,-2,-4
-9,-8,-1,-5
-8,-7,-5,0
-8,-7,-4,-2
-8,-7,-4,-1
-8,-7,-3,-2
-8,-7,-2,-4
-8,-7,-2,-3
-8,-7,-1,-4
-8,-7,0,-5
-7,-6,-5,1
-7,-6,-4,-1
-7,-6,-4,0
-7,-6,-3,-1
-7,-6,-2,-2
-7,-6,-1,-4
-7,-6,-1,-3
-7,-6,0,-4
-7,-6,1,-5
-6,-6,-3,-2
-6,-6,-2,-3
-6,-5,-5,2
-6,-5,-4,0
-6,-5,-4,1
-6,-5,-3,0
-6,-5,-2,-1
-6,-5,-1,-2
-6,-5,0,-4
-6,-5,0,-3
-6,-5,1,-4
-6,-5,2,-5
-5,-5,-3,-1
-5,-5,-1,-3
-5,-4,-5,3
-5,-4,-4,1
-5,-4,-4,2
-5,-4,-3,1
-5,-4,-2,0
-5,-4,-1,-1
-5,-4,0,-2
-5,-4,1,-4
-5,-4,1,-3
-5,-4,2,-4
-5,-4,3,-5
-4,-4,-3,0
-4,-4,0,-3
-4,-3,-5,4
-4,-3,-4,2
-4,-3,-4,3
-4,-3,-3,2
-4,-3,-2,-1
-4,-3,-2,1
-4,-3,-1,-2
-4,-3,-1,0
-4,-3,0,-1
-4,-3,1,-2
-4,-3,2,-4
-4,-3,2,-3
-4,-3,3,-4
-4,-3,4,-5
-3,-3,-3,1
-3,-3,1,-3
-3,-2,-5,5
-3,-2,-4,3
-3,-2,-4,4
-3,-2,-3,3
-3,-2,-2,0
-3,-2,-2,2
-3,-2,-1,1
-3,-2,0,-2
-3,-2,0,0
-3,-2,1,-1
-3,-2,2,-2
-3,-2,3,-4
-3,-2,3,-3
-3,-2,4,-4
-3,-2,5,-5
-2,-2,-3,2
-2,-2,-1,-1
-2,-2,2,-3
-2,-1,-4,5
-2,-1,-3,4
-2,-1,-2,1
-2,-1,-2,3
-2,-1,-1,2
-2,-1,0,1
-2,-1,1,-2
-2,-1,1,0
-2,-1,2,-1
-2,-1,3,-2
-2,-1,4,-3
-2,-1,5,-4
-1,0,-3,4
-1,0,-3,5
-1,0,-2,4
-1,0,-1,3
-1,0,0,2
-1,0,1,1
-1,0,2,0
-1,0,3,-1
-1,0,4,-3
-1,0,4,-2
-1,0,5,-3
0,0,-2,3
0,0,-1,1
0,0,1,-1
0,0,3,-2
0,1,-2,4
0,1,-2,5
0,1,-1,2
0,1,-1,4
0,1,0,3
0,1,1,2
0,1,2,-1
0,1,2,1
0,1,3,0
0,1,4,-2
0,1,4,-1
0,1,5,-2
1,1,-1,3
1,1,0,1
1,1,1,0
1,1,3,-1
1,2,-1,4
1,2,-1,5
1,2,0,4
1,2,1,1
1,2,1,3
1,2,2,2
1,2,3,1
1,2,4,-1
1,2,4,0
1,2,5,-1
2,2,1,2
2,2,2,1
2,3,0,5
2,3,1,3
2,3,1,4
2,3,2,2
2,3,2,3
2,3,3,1
2,3,3,2
2,3,4,1
2,3,5,0
-8,-7,-3,-3
-7,-6,-3,-2
-7,-6,-2,-3
-6,-5,-3,-1
-6,-5,-2,-2
-6,-5,-1,-3
-5,-5,-2,-2
-5,-4,-3,0
-5,-4,-2,-1
-5,-4,-1,-2
-5,-4,0,-3
-4,-4,-2,-1
-4,-4,-1,-2
-4,-3,-3,1
-4,-3,-2,0
-4,-3,-1,-1
-4,-3,0,-2
-4,-3,1,-3
-3,-3,-2,0
-3,-3,-1,-1
-3,-3,0,-2
-3,-2,-3,2
-3,-2,-2,1
-3,-2,-1,-1
-3,-2,-1,0
-3,-2,0,-1
-3,-2,1,-2
-3,-2,2,-3
-2,-2,-2,1
-2,-2,-1,0
-2,-2,0,-1
-2,-2,1,-2
-2,-1,-3,3
-2,-1,-2,2
-2,-1,-1,0
-2,-1,-1,1
-2,-1,0,-1
-2,-1,0,0
-2,-1,1,-1
-2,-1,2,-2
-2,-1,3,-3
-1,-1,-2,2
-1,-1,-1,0
-1,-1,-1,1
-1,-1,0,-1
-1,-1,0,0
-1,-1,1,-1
-1,-1,2,-2
-1,0,-2,3
-1,0,-1,1
-1,0,-1,2
-1,0,0,0
-1,0,0,1
-1,0,1,-1
-1,0,1,0
-1,0,2,-1
-1,0,3,-2
0,0,-1,2
0,0,0,1
0,0,1,0
0,0,2,-1
0,1,-1,3
0,1,0,1
0,1,0,2
0,1,1,0
0,1,1,1
0,1,2,0
0,1,3,-1
1,1,0,2
1,1,1,1
1,1,2,0
1,2,0,3
1,2,1,2
1,2,2,1
1,2,3,0
```

---

## CYTools Computed κ_ijk (sample)

Using CYTools with heights triangulation and basis.dat:

```
kappa[0,0,0] = -9
kappa[0,0,20] = -1
kappa[0,0,24] = 2
kappa[0,0,25] = -1
kappa[0,0,36] = 2
kappa[0,0,42] = 1
kappa[0,0,66] = -1
kappa[0,0,68] = -1
kappa[0,0,85] = -1
kappa[0,0,120] = 1
kappa[0,0,122] = 2
kappa[0,0,139] = 2
kappa[0,0,156] = 4
kappa[0,0,170] = -1
kappa[0,0,183] = 2
kappa[0,0,200] = -1
kappa[0,1,148] = 1
kappa[0,1,174] = 1
kappa[0,1,175] = 1
kappa[0,1,190] = 1
```

Total non-zero κ entries: 1811

---

## The Code That Fails

```python
import numpy as np
from cytools import Polytope

# Load points (294 x 4)
points = np.array([...])  # from points.dat

# Load heights (219 values)
heights = np.array([...])  # from heights.dat

# Load basis (214 indices)
basis = [1,2,3,4,5,6,7,11,12,13,...]  # from basis.dat

# Load t values (214 values)
t = np.array([...])  # from kahler_param.dat

# Create geometry
poly = Polytope(points)
tri = poly.triangulate(heights=heights)  # 1011 simplices
cy = tri.get_cy()  # h11=214, h21=4

# Set basis
cy.set_divisor_basis(basis)

# Get intersection numbers
kappa_sparse = cy.intersection_numbers(in_basis=True)

# Build tensor
kappa = np.zeros((214, 214, 214))
for row in kappa_sparse:
    i, j, k, val = int(row[0]), int(row[1]), int(row[2]), row[3]
    # Symmetrize
    for perm in [(i,j,k), (i,k,j), (j,i,k), (j,k,i), (k,i,j), (k,j,i)]:
        kappa[perm] = val

# Compute volume
V = np.einsum('ijk,i,j,k->', kappa, t, t, t) / 6.0
print(V)  # 17901.22 - WRONG! Should be 4711.83
```

---

## What We've Ruled Out

1. ✅ CYTools version - same result with 2021 and 2024 versions
2. ✅ Triangulation - heights.dat gives correct 1011 simplices
3. ✅ Frame conversion - ratio 3.8 ≠ g_s^(3/2) = 0.00087
4. ✅ Basis accepted - CYTools accepts basis.dat indices

---

## Hypotheses

### H1: Index Offset
basis.dat starts at 1, not 0. Maybe need to subtract 1?

### H2: Point Index vs Divisor Index
basis.dat might index into points array, not divisors.

### H3: Transformation Matrix
McAllister might use a different linear combination of divisors.

### H4: Missing Indices (8,9,10,17)
The skipped indices might be relevant - they could be linear combinations.

---

## Key Observation

The ratio V_computed/V_target = 3.80 ≈ 4.

This might indicate:
- A factor of 4 normalization difference
- Wrong counting of something (simplices? symmetry?)
- Index mapping that effectively counts ~4x

---

## References

1. McAllister et al., arXiv:2107.09064, "Vacua with Small Flux Superpotential"
2. CYTools: https://cy.tools/docs/
3. Data: https://arxiv.org/src/2107.09064/anc
