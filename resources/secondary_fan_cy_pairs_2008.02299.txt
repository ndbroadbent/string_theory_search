arXiv:2008.02299v2 [math.AG] 18 Jan 2022

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU
PAIRS
PAUL HACKING, SEAN KEEL, AND TONY YUE YU

We conjecture that any connected component Q of the moduli space of
Abstract.
triples (X, E = E1 + Â· Â· Â· + En , Î˜) where X is a smooth projective variety, E is a normal
crossing anti-canonical divisor with a 0-stratum, every Ei is smooth, and Î˜ is an ample
divisor not containing any 0-stratum of E, is unirational. More precisely: note that
Q has a natural embedding into the KollÃ¡r-Shepherd-Barron-Alexeev moduli space of
stable pairs, we conjecture that the induced compactification admits a finite cover by a
complete toric variety. We construct the associated complete toric fan, generalizing the
Gelfand-Kapranov-Zelevinski secondary fan for reflexive polytopes. Inspired by mirror
symmetry, we speculate a synthetic construction of the universal family over this toric
variety, as the Proj of a sheaf of graded algebras with a canonical basis, whose structure
constants are given by counts of non-archimedean analytic disks. In the Fano case and
under the assumption that the mirror contains a Zariski open torus, we construct the
conjectural universal family, generalizing the families of Kapranov-Sturmfels-Zelevinski
and Alexeev in the toric case. In the case of del Pezzo surfaces with an anti-canonical
cycle of (âˆ’1)-curves, we prove the full conjecture.

Contents
1. Introduction and statement of results
2. The secondary fan
2.1. Construction of the section Ï•
2.2. Moving cones
2.3. Bogus cones
2.4. The secondary fan in the del Pezzo case
3. Rephrasing the mirror algebra using the universal torsor
4. Central fiber as an umbrella
4.1. Counts of balanced spines in dimension two
5. Toric fiber bundles
6. The mirror family over the toric variety for the secondary fan
6.1. The mirror algebra for K
6.2. Extension to the moving part of the secondary fan
6.3. The boundary torus action
6.4. Extension to the full secondary fan
6.5. An inductive structure on the mirror family
7. Singularities of the mirror family
8. Modularity of the mirror family
Date: January 10, 2022.
2020 Mathematics Subject Classification. Primary 14J33; Secondary 14J10, 14J32, 14E30, 14G22.
1

2
6
6
7
10
11
14
17
18
19
21
22
24
26
26
27
29
32

2

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

8.1. Proof of the main theorem
8.2. The mirror family for P1 -fibrations
8.3. Speculative strategy for the general conjecture
References

33
36
38
38

1. Introduction and statement of results
We propose the following conjecture regarding the moduli space of smooth polarized Calabi-Yau
pairs:
Conjecture 1.1. Any connected component Q of the coarse moduli space of triples (X, E =
E1 + Â· Â· Â· + En , Î˜) where
(1) X is a connected smooth projective complex variety,
(2) E âˆˆ |âˆ’KX | is a normal crossing divisor with a 0-stratum, every Ei is smooth,
(3) Î˜ âŠ‚ X is an ample divisor not containing any 0-stratum of E,
is unirational.
We have a more precise form of the above conjecture. Note that in view of conditions (1-2), (3)
is equivalent to the condition that for sufficiently small  > 0, (X, E + Î˜) is a stable pair1 (see
[27, Â§5]), thus Q immerses into SP, the moduli space of stable pairs (which is a higher-dimensional
generalization of the moduli space Mg,n of stable pointed curves, see [26]). Let Q denote the closure
of Q in SP.
Conjecture 1.2. There is a complete toric variety T with a finite surjective map T â†’ Q.
We prove Conjecture 1.2 in the following special case:
Theorem 1.3. Conjecture 1.2 holds when X is a del Pezzo surface, E âˆˆ |âˆ’KX | is a cycle of
KX -degree-(âˆ’1) curves, and Î˜ âˆˆ |âˆ’KX |.
We introduce a generalization of the Gelfand-Kapranov-Zelevinski secondary fan [11] and conjecture T to be the associated toric variety. Moreover, we conjecture a synthetic construction of the
pullback family over T , generalizing the mirror construction of [24] (cf. [12, 17, 18]), as the Proj of a
sheaf of graded algebras with a canonical basis, whose structure constants are given by counts of
non-archimedean analytic disks â€” we refer to this throughout the paper as the mirror family. By
construction, every fiber is endowed with a canonical theta function basis of sections of every power
of the polarization. We prove these conjectures under the assumptions of Theorem 1.3.
Our speculations are led by considerations from mirror symmetry. From the viewpoint of birational
geometry, even the conjecture that Q is uniruled does not strike us as at all obvious. Furthermore, we
are predicting that there is a (nearly uni) versal family of stable pairs parametrized by an algebraic
torus. In dimension two, although there is an elementary construction of versal families of pairs
(X, E) in [14], it is without the divisor Î˜, and does not apply to the stable pair compactifications.
We do not know any elementary constructions in higher dimensions.
Our generalization of the GKZ secondary fan is a general construction, of independent interest,
mixing ideas from Mori theory and Berkovich geometry, see Section 2. When X is Fano and
Î˜ âˆˆ |âˆ’KX |, our secondary fan Sec is a complete rational polyhedral fan with support Pic(Y )R ,
1It is sometimes called KSBA stable pair in honor of the works of KollÃ¡r-Shepherd-Barron [25] and Alexeev [1].

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

3

which is a coarsening of the Mori fan for the mirror Calabi-Yau pair (Y, D). Under the further
assumption that U := Y \ D contains a Zariski open torus2, we build the mirror family of triples
(X , E, Î˜) over (the complete toric variety) TV(Sec), by gluing together Proj(AÎ± ) for graded rings
AÎ± constructed from counts of non-archimedean analytic disks in Y an as in [24, Â§1.1] (based on
ideas from [38, 39]). We show that all the fibers (X, E) are semi-log-canonical, and the generic fiber
(X, E + Î˜) is stable for sufficiently small  > 0, see Proposition 7.1. In the case when Y is del
Pezzo, we can prove more:
Theorem 1.4 (see Theorem 8.2). In the two-dimensional case, the following hold:
(1) The mirror family (X , E) â†’ TV(Sec) is a flat family of semi-log-canonical pairs (X, E) with
KX + E trivial, and H i (X, OX ) = 0 for i > 0.
(2) The boundary E â†’ TV(Sec) is a trivial family, with fiber a cycle of rational curves.
(3) For every fiber (X, E) over the structure torus TPic(Y ) âŠ‚ TV(Sec), X is a del Pezzo surface
with at worst du Val singularities, E âŠ‚ X is an anti-canonical cycle of KX -degree-(âˆ’1)
rational curves, and the self-intersection number of KX is equal to the number of irreducible
components of D.
(4) For 0 <   1, (X , E + Î˜) â†’ TV(Sec) is a family of stable pairs.
(5) The induced map TV(Sec) â†’ SP to the moduli space of stable pairs is finite.
Finally when Y is del Pezzo and D âŠ‚ Y is an anti-canonical cycle of (âˆ’1)-curves, we prove that
the image of the finite map TV(Sec) â†’ SP is the full deformation space Q âŠ‚ SP, where Q is the
moduli space in Conjecture 1.1 for the pair (Y, D), see Theorem 8.3.
Remark 1.5. Mirror symmetry suggests that deformation types of (X, E) as in Conjecture 1.1
come in dual pairs, generalizing the Batyrev duality via reflexive polytopes [3]. The mirror to a
pair (Y, D) with Y a smooth del Pezzo consists of pairs (X, E) with E a cycle of KX -degree-(âˆ’1)
curves on a del Pezzo X with an Akâˆ’1 singularity at the node of E corresponding to an irreducible
component of D of KX -degree âˆ’k. So the mirror can only be smooth when D âŠ‚ Y is a cycle of
KX -degree-(âˆ’1) curves, which is why we specialize to this case in Theorem 1.3. It is possible to
have an analog of Theorem 1.3 where we allow such Akâˆ’1 singularities, see Remark 8.5.
Remark 1.6. A version of mirror algebra has been constructed by Gross-Siebert [18] in much
greater generality using counts of punctured log curves instead of non-archimedean analytic curves.
However, in order to produce a family over the complete toric base associated to the secondary
fan, one must show that the multiplication rule of the mirror algebra depends only on the log
Calabi-Yau U := Y \ D, not on the compactification U âŠ‚ Y , (up to change of curve classes in the
coefficients). This is easy from the non-archimedean approach, because the (punctured) analytic
disks that contribute to the structure constants live inside the log Calabi-Yau U ; however, this is
currently unknown (and not at all clear) for the punctured log curve approach of Gross-Siebert,
because the log curves can have components mapping completely into the boundary D). For the
moment the non-archimedean construction of mirror algebra has only been carried out under the
assumption of containing a Zariski open torus. As soon as the non-archimedean mirror construction
generalizes to all affine log Calabi-Yau varieties with maximal boundary, the construction of the
universal family over the toric variety associated to the secondary fan in this paper can also be
extended to the general case of Fano varieties. Section 8.3 contains a speculative discussion about
how one might approach Conjecture 1.2 in full generality.
2This always holds if Y is 2-dimensional; there are also many important higher dimensional cluster variety examples,
e.g. an open Richardson variety inside a flag manifold, see [35].

4

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Now let us give a more detailed overview of what we do in this paper:
As a guide let us first consider briefly the case where (Y, D) is toric Fano. Let M denote the
cocharacter lattice of the torus U := Y \ D. Since Y is Fano, the first lattice points on the rays of
the dual fan Î£(Y,D) are the vertices of a reflexive convex lattice polytope Î› âŠ‚ MR , in particular
0 âˆˆ Î› is the unique lattice point (see [3]). The mirror to (Y, D) is the polarized toric Fano (X, E)
given by Î›. In this case, Conjecture 1.2 can be deduced from Kapranov-Sturmfels-Zelevinsky [22]
and Alexeev [2, 1.2.15]. The finite map T â†’ Q is a normalization, and T is the toric variety
associated to the GKZ secondary fan, which contains a cone for each tiling Î› of Î› given by a convex
piecewise affine function. The theta function basis for the homogeneous coordinate ring of the mirror
family over T consists of monomials corresponding to the lattice points in the cone Î“ over Î›. The
multiplication rule in the basis is simply the toric one: Î¸P Â· Î¸Q = Î¸P +Q , addition in the ambient
lattice M âŠ• Z âŠƒ Î“(Z).
Now consider a general pair (Y, D) with Y smooth Fano and D âŠ‚ Y a normal crossing anticanonical divisor containing a 0-stratum. Let p : K â†’ Y denote the canonical bundle, and K â†’ K
the contraction of the 0-section. The divisor D âˆˆ |âˆ’KY | gives a function d : K â†’ A1 . The central
fiber DK := dâˆ’1 (0) âŠ‚ K has normal crossings; we denote its dual complex by Î›. Note that the
complement V := K \ DK is log Calabi-Yau, and p Ã— d : V â†’ U Ã— Gm is an isomorphism, where
U := Y \ D. Let Î“ denote the cone complex over Î›. The generalization of the ambient lattice
M âŠ• Z âŠ‚ MR âŠ• R is
Sk(V, Z) âŠ‚ Sk(V ) âŠ‚ V an ,
where V an denotes the Berkovich analytification with respect to the trivial valuation on C, Sk(V )
the Kontsevich-Soibelman essential skeleton, and Sk(V, Z) the integer points inside (see [24, Â§2] for
a quick description of these objects).
Note K/K is a relative Mori dream space, and Mori theory provides a complete fan MoriFan,
with support Pic(K/K)R â‰ƒ Pic(Y )R . It contains a maximal cone Nef(K 0 ) âŠ‚ Pic(K/K)R for each
flop K 99K K 0 over K, as well as bogus cones (see Section 2.2). Note K 0 99K A1 is again regular,
and the dual complex of the central fiber gives another triangulation Î›0 of the underlying topological
space Î› of Î›. In the toric case, MoriFan is isomorphic to the GKZ secondary fan. However, in
general MoriFan gives the wrong base for the mirror family: Although the mirror family extends
over the associated toric variety TV(MoriFan), the induced map to the moduli space SP of stable
pairs is not in general finite. For example, when Y is del Pezzo, the exceptional locus of K 99K K 0
is a disjoint union of (âˆ’1)-curves in Y âŠ‚ K. Consider the case of a single exceptional (âˆ’1)-curve C,
then Nef(K) and Nef(K 0 ) are adjacent maximal cones of MoriFan meeting along a codimension-one
face, determining a boundary 1-stratum S âŠ‚ âˆ‚ TV(MoriFan). If C is internal, i.e. not an irreducible
component of D âŠ‚ Y , then the restriction of the mirror family to S will be trivial, and the map
TV(MoriFan) â†’ SP contracts S to a point. In order to remedy this problem, we observe in this
case that the triangulations Î› and Î›0 are the same. So the rough idea is to coarsen the Mori fan
by gluing cones associated with same tilings of Î›. We call the resulting fan the secondary fan,
denote it by Sec, and prove that the mirror family over (the toric variety associated to) the Mori
fan indeed descends to the secondary fan. The precise construction of the secondary fan relies on
Berkovich geometry and Mori theory, and is quite different from the Gelfand-Kapranov-Zelevinski
toric construction (see Section 2, see also Remark 2.30 for an alternative explicit description in the
del Pezzo case).
The mirror family over the toric base TV(Sec) is constructed in Section 6. We start from the
family over the nef cone Nef(K): as in the toric case, the associated mirror algebra A has a basis
parametrized by the integer points Î“(Z), but the multiplication rule is much more subtle, given by

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

5

counts of non-archimedean analytic disks in K an . The tropicalization dtrop : Sk(V, Z) â†’ Z gives
a grading on A, then Proj A gives the mirror family X over the nef cone; the boundary E âŠ‚ X is
given by the ideal generated by the integer points Î“â—¦ (Z) in the interior of Î“, and the divisor Î˜ is
the zero-locus of the sum of sections associated to the integer points Î›(Z) in Î›. We carry out the
same construction for every flop K 99K K 0 over K; then by rephrasing the mirror algebras using
universal torsor as in Section 3, the mirror families for various K 0 glue together to a family over the
moving part of the secondary fan, see Section 6.2. The extension to the full secondary fan is carried
out in Section 6.4, which relies on the equivariant boundary torus action of Section 6.3 and the toric
fiber bundle construction of Section 5.
We study the singularities in Section 7. We show that the mirror family (X , E) over the nef
cone is a family of semi-log-canonical Fano varieties with log-canonical generic fiber, moreover for
sufficiently small  > 0, the generic fiber (X, E + Î˜) is stable, thus the family determines at least
a rational map TV(Sec) 99K SP, see Proposition 7.1. We conjecture all the fibers are stable, and
that the induced regular map to SP is finite. We have much better control on singularities in the
del Pezzo case, see Theorem 1.4 (or 8.2). Our proof uses the equivariant boundary torus action
to push any fiber (X, E) to the fiber over a 0-stratum of the toric base, which admits explicit
geometric descriptions. Note that over an orbit of the boundary torus action, (X, E) is constant,
but Î˜ varies, by arbitrary scaling of the non-zero coefficients: the weights for the theta function
basis of Î“(X, O(1)) are exactly the coordinates on the boundary torus. Thus the condition that Î˜
does not pass any log-canonical center of (X, E) has a striking implication: all but exactly one of
the (degree-one) theta functions must vanish at each log-canonical center, see Claim 8.6, because
otherwise by scaling we can move Î˜ so that it would contain a log-canonical center.
Finally we note one pleasant feature of our construction, that points up how desirable it is to
find the correct fan: In general, to prove modularity one would expect to need some deformation
theory, or as in [15], a Torelli theorem and computation of periods. However, note that a map from
a complete toric variety to a scheme is finite if and only if no boundary 1-stratum is contracted to a
point, see Lemma 8.7. While our mirror family built from non-archimedean enumerative geometry
is quite complicated (it is after all, versal), the restrictions over 1-strata of the base toric variety are
vastly simpler. So we are able to show that they are non-trivial (i.e. no 1-stratum is contracted by the
map to SP), by exhibiting the smoothing of either a double curve or a 0-dimensional log-canonical
center, see Claim 8.8. Once we have the finite map TV(Sec) â†’ SP, we show that its image is the
full deformation space Q (notation as in Theorem 1.3) by dimension count, see Theorem 8.3.
Remark 1.7. In the del Pezzo case, the mirror family (X , E, Î˜) â†’ TV(Sec) is equivariant with
respect to a natural (finite) Weyl group W (see [14]) and the map to SP factors through the
quotient. We expect the induced finite map TV(Sec)/W â†’ SP is the normalization of its image; so
in particular, in this case the normalization of Q from Theorem 1.3 is a quotient of a toric variety
by a finite group. This is very special, as irreducible components of SP can be very complicated,
even for the pair of P2 and a collection of general lines, see [23, 1.3, 3.13]. We are very interested in
the question of how to generalize this Weyl group to higher dimensions.
Acknowledgments. We enjoyed fruitful conversations with P. Achinger, V. Alexeev, M. Baker,
V. Berkovich, F. Charles, A. Corti, A. Durcos, W. Gubler, J. KollÃ¡r, M. Porta, J. Rabinoff, D.
Ranganathan, M. Robalo and Y. Soibelman. We were heavily inspired and influenced by our
long-term collaborations with M. Gross, M. Kontsevich and B. Siebert. Hacking was supported by
NSF grants DMS-1601065 and DMS-1901970. Keel was supported by NSF grant DMS-1561632. T.Y.
Yu was supported by the Clay Mathematics Institute as Clay Research Fellow. Some of the research

6

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

was conducted while Keel and Yu visited the Institute for Advanced Study in Princeton, and some
while the three authors visited the Institut des Hautes Ã‰tudes Scientifiques in Bures-sur-Yvette.
2. The secondary fan
In this section, we give a generalization of the Gelfand-Kapranov-Zelevinski secondary fan [11].
Here is the basic idea: Consider a Q-factorial compactification of a log Calabi-Yau variety V âŠ‚ K,
with Pic(K) a lattice. Let G â†’ K be the universal torsor. The restriction T := G|V is again log
Calabi-Yau, hence we obtain a map between essential skeletons Sk(T ) â†’ Sk(V ), which admits a
canonical section Ï• : Sk(V ) â†’ Sk(T ), see Section 2.1. Then the secondary fan Sec(K) restricted to
the cone Mov(K) âŠ‚ Pic(K)R of moving divisors, is the coarsening of the Mori fan, whose maximal
cones are unions of Nef(K 0 ) over all flops K 99K K 0 for which the sections Ï•0 coincide. We prove
that such unions are convex, see Theorem 2.12. A similar gluing for bogus cones is worked out in
Section 2.3. An explicit description of the secondary fan in the del Pezzo case is given in Section 2.4.
2.1. Construction of the section Ï•. Let k be a non-archimedean field (trivial valuation allowed),
and X a scheme locally of finite type over k. We can analytify X in the sense of Berkovich [4]
and obtain a k-analytic space X an . The underlying topological space of X an has a very simple
description, which we recall for readersâ€™ convenience:
As a set, X an consists of pairs (Î¾, |Â·|), where Î¾ âˆˆ X is a scheme point, and |Â·| is an absolute value
on the residue field Îº(Î¾) extending the one on k. The topology on X an is the weakest one such that
the forgetful map Ï€ : X an â†’ X is continuous, and that for all Zariski open U âŠ‚ X, f âˆˆ OX (U ), the
function
Ï€ âˆ’1 (U ) âˆ’â†’ Râ‰¥0 ,

(Î¾, |Â·|) 7âˆ’â†’ |f (Î¾)|

is continuous.
When k has trivial valuation, we have a canonical analytic subdomain X i âŠ‚ X an , consisting of
(Î¾, |Â·|) such that the center of the absolute value lies inside X, see [37, Definition 1.3]. The inclusion
is an equality when X is proper.
Construction 2.1. Let X, Y be formal schemes locally of finite presentation over the ring of
integers k â—¦ . Let f : X â†’ Y be a flat morphism with geometrically integral fibers. We can construct
a canonical set-theoretic section Ï• : YÎ· âˆ’â†’ XÎ· as follows:
For every y âˆˆ YÎ· , let H(y) denote its complete residue field. Let Z be the pullback of X along
Spf H(y)â—¦ â†’ Y. By assumption, it is an admissible formal scheme over H(y)â—¦ with integral special
fiber Zs , and generic fiber ZÎ· â‰ƒ (XÎ· )y . Let Ï€ : ZÎ· â†’ Zs be the reduction map (see [5, Â§1]). By [4,
2.4.4(ii)], the preimage of the generic point of Zs by Ï€ gives a unique point in ZÎ· â‰ƒ (XÎ· )y , which we
take to be the image Ï•(y) âˆˆ (XÎ· )y âŠ‚ XÎ· .
In particular, we note the following special case when k has trivial valuation: Let f : X â†’ Y be a
flat map of k-varieties with geometrically integral fibers. Then we have a canonical set-theoretic
section
Ï• : Y i âˆ’â†’ X i âŠ‚ X an .
Assumption 2.2. From now on we assume that k has trivial valuation. Fix a smooth log Calabi-Yau
variety V with volume form Ï‰V (unique up to scaling). Fix a partial compactification V âŠ‚ K, with
K normal. In our application K will be the total space of the canonical bundle of a smooth variety,
whence our choice of letter.

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

7

Construction 2.3. Given any lattice N âŠ‚ Pic(K), denote M := N âˆ— and consider the universal
torsor
M 
:=
Ï€: G
Spec
L âˆ’â†’ K,
LâˆˆN

which is a principal
T N := TM := M âŠ—Z Gm/k = Spec(k[N ])
bundle, and the action of T N is given by the N -grading. Denote T := G|V . The torus bundle has
a canonical relative volume form, wedging with Ï‰V gives a volume form on T , making T also log
Calabi-Yau. Let Sk(V ) âŠ‚ V an and Sk(T ) âŠ‚ T an denote the essential skeletons (see [24, Â§2]), and let
e := Sk(T )|Î“ . Applying Construction 2.1, we obtain Ï• : K i â†’ Gi , a section of
Î“ := Sk(V ) âˆ© K i , Î“
e a section of Î“
e â†’ Î“.
the projection. It follows from the construction that Ï• restricts to Ï• : Î“ â†’ Î“,
Remark 2.4. Given any other compactification V âŠ‚ K 0 with K 0 â†’ K proper, consider the pullback
e0 = Î“
e and
G0 of G, and apply the above construction. We have T 0 = T , Sk(T 0 ) = Sk(T ), Î“0 = Î“, Î“
0
Ï• = Ï•. So for computing Ï• one can always resolve K.
e â†’ Î“ and the section Ï• : Î“ â†’ Î“
e are basic objects in several
Remark 2.5. The N1 (K, R)-bundle Î“
previous works on mirror symmetry [12, 15, 16], arising in a (it seems to us) rather ad hoc way. As
far as we know, the above canonical non-archimedean theoretic description is new.
e By Remark 2.4 we may assume
Remark 2.6. Let us give a more explicit description of Ï• : Î“ â†’ Î“.
that (K, D := K \ V ) is snc. Let Dess âŠ‚ D be the union of essential divisors, i.e. irreducible
components where Ï‰V has a pole, and Î£ := Î£(K,Dess ) the dual cone complex. Let S1 . . . , Sm âˆˆ
Ã—
N âŠ‚ Pic(K) be a line bundle basis so that G â‰ƒ LÃ—
1 Ã— . . . Lm , where Li denotes the dual of Si , and
LÃ—
âŠ‚
L
denotes
the
complement
of
the
zero
section.
By
[24, Lemma 8.5], we have a canonical
i
i
i
identification Î“ = Sk(V ) âˆ© K â‰ƒ |Î£|.
Let Ï€ : T := P(âŠ•i Li âŠ• O) â†’ K. Similarly we have
e = Sk(T )|Î“ = Sk(T ) âˆ© T i â‰ƒ Î£
e
Î“
(T ,(T \T )ess ) =: Î£.
e the subcomplex generated by the rays
Note we have a natural inclusion of cone complexes Î£ âŠ‚ Î£,
corresponding to the irreducible components of Ï€ âˆ’1 (Dess ); moreover, we have a natural projection
e â†’ Î£. These coincide with Ï• : Î“ â†’ Î“
e and Ï€ : Î“
e â†’ Î“ respectively, via the identifications with the
Î£
skeletons.
2.2. Moving cones. We recall some notions of birational geometry from [21]. A small Q-factorial
modification (SQM for short) is a birational map f : X 99K X 0 of normal Q-factorial projective
varieties that is an isomorphism in codimension 1. A normal Q-factorial projective variety X is
called a Mori dream space if
(1) Pic(X) is finitely generated,
(2) Nef(X) is generated by finitely many semi-ample divisors,
(3) there is a finite collection of SQMs fi : X 99K Xi , such that each Xi satisfies (2), and the
cone of moving divisors Mov(X) is the union of fiâˆ— (Nef(Xi )).
A Mori dream space X has a simple Mori chamber decomposition via Mori equivalence of line
bundles, giving rise to a finite polyhedral fan MoriFan(X), called Mori fan, which is supported on
the cone of effective divisors Eff(X) (see [21, Proposition 1.11]). Each maximal cone of MoriFan(X)
is of the form
f âˆ— Nef(Y ) + hex(f )i ,

8

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

for a birational contraction f : X 99K Y with Y a Mori dream space, where hex(f )i denotes the
subcone of Eff(X) spanned by f -exceptional effective divisors.
We denote by MovFan(X) the restriction of MoriFan(X) to the cone of moving divisors Mov(X),
and call it the moving fan. Each of its maximal cones is of the form f âˆ— Nef(X 0 ) for an SQM
f : X 99K X 0 . The maximal cones of MoriFan(X) not contained in Mov(X) are called bogus cones.
Assumption 2.7. In addition to Assumption 2.2, we fix regular proper map q : K â†’ K, and
assume K/K is a relative Mori dream space. Given an SQM K 99K K 0 over K, we have a canonical
identification Pic(K)Q â‰ƒ Pic(K 0 )Q . Whenever we consider various cones, e.g. NE, Nef, and fans,
e.g. MoriFan, for K or K 0 , we will always mean relative to K. Note that for sufficiently divisible
n, n Pic(K 0 ) âŠ‚ Pic(K 0 ) is free, and n Pic(K 0 ) âŠ‚ Pic(K)Q is independent of the SQM. We fix
such an N := n Pic(K 0 ) âŠ‚ Pic(K)Q throughout the paper, and let M denote its dual. We have a
canonical projection N1 (K 0 , Z) â†’ M, and write NE(K 0 )M âŠ‚ M for the image of NE(K 0 , Z). For our
later application to Theorem 1.3, all SQM K 0 will be smooth and we will simply take n = 1 and
N := Pic(K).
eâ†’Î“
Construction 2.8. Applying Construction 2.3 to K and N âŠ‚ Pic(K), we obtain G â†’ K, Î“
0
e Given an SQM f : K 99K K over K, applying Construction 2.3 to K 0 and
and a section Ï• : Î“ â†’ Î“.
0
e 0 . Since the volume forms agree,
e 0 â†’ Î“0 and a section Ï•0 : Î“0 â†’ Î“
N âŠ‚ Pic(K ), we obtain G0 â†’ K 0 , Î“
e=Î“
e 0 . So Ï•0 : Î“0 â†’ Î“
e 0 gives also a
and q : K â†’ K, q 0 : K 0 â†’ K are proper, we have Î“ = Î“0 and Î“
e
section of Î“ â†’ Î“, which is in general different from Ï•.
Proposition 2.9. Let f : K1 99K K2 be an SQM over K corresponding to two maximal cones of
MovFan(K). The following hold:
(1) The difference Ï•K2 âˆ’ Ï•K1 : Î“ â†’ MR has image in NE(K1 ), (note the difference is between
two sections of a principal N1 (K, R)-bundle, hence an N1 (K, R)-valued function.)
(2) Let L âˆˆ Nef(K1 ) âˆ© Nef(K2 ), then Ï•K2 âˆ’ Ï•K1 has image in LâŠ¥ .
The proposition will follow from a more precise statement:
Lemma 2.10. Choose a Q-factorial projective variety Z with birational morphisms pi : Z â†’ Ki . Let
L âˆˆ Pic(K)Q , and write pâˆ—1 L = pâˆ—2 LâŠ—O(E) for a Q-Cartier divisor E supported on the pi -exceptional
loci (since f is small, p1 and p2 have the same exceptional divisors). Then
(Â·L) â—¦ (Ï•K1 âˆ’ Ï•K2 ) = E trop : Î“ âˆ’â†’ R,
where E trop is given by taking valuation of local defining equations of E, see [24, Construction 15.1].
Proof. Put Ï•i := (Â·L) â—¦ Ï•Ki . Let v âˆˆ Î“, H(v) its complete residue field, and H(v)â—¦ the valuation
ring. By the properness of Z, we get a map Spec H(v)â—¦ â†’ Z. Now for computing (Ï•1 âˆ’ Ï•2 )(v)
we can replace Z by Spec H(v)â—¦ . Furthermore, we can replace Pic(K) by the sublattice generated
by L. We can also assume that E is effective Cartier. Let e âˆˆ H(v) be a defining equation for
(the pullback of) E. Choose a trivialization, i.e. a nowhere vanishing section s, of pâˆ—2 L and write
pâˆ—2 L â‰ƒ Spec H(v)â—¦ [X2 ]. By pâˆ—1 L = pâˆ—2 L âŠ— O(E), es gives a trivialization of pâˆ—1 L, so we can write
pâˆ—1 L â‰ƒ Spec H(v)â—¦ [X1 ] where X1 = X2 /e over the generic fiber. By construction, Ï•K2 (v) is the
Gauss point on the generic fiber with respect to the coordinate X2 , while Ï•K1 (v) is the Gauss point
with respect to the coordinate X1 = X2 /e. Therefore,
Ï•1 (v) âˆ’ Ï•2 (v) = val X2 (Ï•K1 (v)) âˆ’ val X2 (Ï•K2 (v)) = val X2 (Ï•K1 (v))
= val eX1 (Ï•K1 (v)) = val X1 (Ï•K1 (v)) + val e = val e = E trop (v),

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

where val denotes the valuation on H(v)â—¦ . This completes the proof.

9


â—¦

Remark 2.11. Notation as in the proof of Lemma 2.10, if Spec H(v) â†’ Ki has image in the open
subset where K1 99K K2 is an isomorphism, then Ï•1 (v) = Ï•2 (v). Note this holds for all v âˆˆ Î“ if the
exceptional loci of K1 99K K2 contain no strata of the boundary.
Proof of Proposition 2.9. (2) follows from (1). For (1), we pick L âˆˆ Nef(K1 ). Notation as in
Lemma 2.10, we see that E is p2 -nef. So âˆ’E is effective by the negativity lemma (see [29, Lemma
3.39]). Thus âˆ’E trop is non-negative. So by Lemma 2.10, (Â·L)â—¦(Ï•K2 âˆ’Ï•K1 ) = âˆ’E trop is non-negative.
Now the result follows from the duality between NE(K1 ) and Nef(K1 ).

Theorem 2.12. Let Î± âŠ‚ MovFan(K) be a maximal cone. Let sec(Î±) be the union of maximal cones
Î² with Ï•Î± = Ï•Î² . Then sec(Î±) is a convex cone. Consequently, the collection of all such sec(Î±) are
the maximal cones of a rational polyhedral fan, denoted by MovSec(K), which is a coarsening of
MovFan(K).
Proof. It suffices to show that for any two maximal cones Î±, Î² âŠ‚ MovFan(K) with Ï•Î± = Ï•Î² , and
any interval f : [0, 1] â†’ MovFan(KÎ³ ) from a general point of Î± to a general point of Î², the whole
image is contained in sec(Î±).
Since the interval is general, it intersects lower dimensional cones at finitely many points; so
we obtain a partition 0 = x0 < x1 < Â· Â· Â· < xn = 1. Denote Ii := [xi , xi+1 ], and Ï•i := Ï•Ki , where
K â†’ Ki is the SQM associated to the unique maximal cone containing f (Ii ). Fix any b âˆˆ Î“ and
consider di,j := Ï•i (b) âˆ’ Ï•j (b). For any y âˆˆ Pic(K)R , write di,j,y := (Â·y) â—¦ di,j .
Note di,j,f (x) is linear on the interval [0, 1]. Assume i â‰¤ j. By Proposition 2.9(1), di,j,f (x) is
non-positive for x âˆˆ Ii and non-negative for x âˆˆ Ij . By linearity, this function is non-decreasing,
and non-positive for all x âˆˆ [0, xi+1 ], and non-negative for all x âˆˆ [xj , 1].
Given any i and x âˆˆ Iiâ—¦ , we claim that d0,i,f (x) = 0. Suppose to the contrary, by the above
paragraph, we have d0,i,f (1) > 0 and di,n,f (1) â‰¥ 0. So
d0,n,f (1) = d0,i,f (1) + di,n,f (1) > 0,
a contraction to the assumption that Ï•Î± = Ï•Î² .
Since f (1) is a general point of Î², by perturbing f (1), we deduce that d0,i,y = 0 for y in a small
neighborhood of f (x); hence d0,i = 0. We conclude that Ï•i = Ï•0 , completing the proof.

Lemma 2.13. Let K 99K K 0 be an SQM over K, if Ï• = Ï•0 , and both pairs (K, V c ) and (K 0 , V c )
are dlt, then the dual complexes of V âŠ‚ K and V âŠ‚ K 0 coincide.
Proof. Let us show that the dual complex of V âŠ‚ K can be recovered from Ï•. Since we are only
considering SQMs, the set of vertices of the dual complex is fixed; we only need to recover the
information of which sets of boundary components have non-empty intersection. Let N = n Pic(K)
be as in Assumption 2.7. Following Constructions 2.8 and 2.3, we have
M
H 0 (G, O) â‰ƒ
H 0 (K, L).
LâˆˆN

For each irreducible component E âŠ‚ D, the canonical section 1nE âˆˆ H 0 (K, O(nE)) gives a regular
function fnE on G whose restriction to T = G|V is invertible. Let ID denote the set of irreducible
components of D, and
W : Sk(T ) âˆ’â†’ RID
trop
x 7âˆ’â†’ { fnE
(x) }EâˆˆID .

10

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Under the isomorphism Î£(V âŠ‚K) â‰ƒ Î“, the composition W â—¦ Ï• : Î“ â†’ RID coincides with the canonical
embedding Î£(V âŠ‚K) âŠ‚ RID (up to scaling by n). Therefore, Ï• determines the dual cone complex
Î£(V âŠ‚K) , hence the dual complex of V âŠ‚ K.

Remark 2.14. We do not know whether the converse holds, i.e. whether equality of the dual
complexes implies Ï• = Ï•0 . This holds when V is a torus, and also when K is the total space of the
canonical bundle of a del Pezzo (as in the context of Theorem 1.3).
2.3. Bogus cones.
Assumption 2.15. We now assume, in addition to Assumption 2.7, q : K â†’ K is birational.
Here we define a canonical extension from the fan MovSec(K) to a coarsening of the full
MoriFan(K). Note since q is birational, the support of MoriFan(K) is the full vector space Pic(K)R .
Lemma 2.16. Let f : Y â†’ Z be a regular birational contraction, with Z Q-factorial. Then the
exceptional locus is pure codimension one.
Proof. Suppose to the contrary there is an irreducible component of the exceptional locus which has
higher codimension, and let A âŠ‚ Y be a general very ample divisor through a general point e âˆˆ E.
Then f âˆ— (fâˆ— (A)) is an effective Q-Cartier divisor, identical to A in a neighborhood of e. On the other
hand, since set theoretically it is the inverse image of f (A), it contains the (positive dimensional)
fiber of f through e, a contradiction.

Lemma 2.17. Let Y be a birational contraction of K. Let f : Y â†’ Z be a regular birational
contraction with Z Q-factorial,
T E1 , . . . , En âŠ‚ Y the exceptional divisors, and Ci âŠ‚ Ei a curve
through a general point. Then i CiâŠ¥ âˆ© Nef(Y ) = Nef(Z).
Proof. The inclusion âŠƒ is obvious. Let us prove the direction âŠ‚. The given intersection defines
a face of Nef(Y ), let A be a rational point in its interior. Since Y is a birational contraction of
K, A is semi-ample; let g : Y â†’ Z 0 be the corresponding contraction. Since the inclusion âŠƒ holds,
the rational map h : Z 0 99K Z is regular. Since f is birational, so are g and h. Since every Ci is
contracted by g, and Ci passes through a general point of Ei , we see that every Ei is g-exceptional.
Therefore, h : Z 0 â†’ Z is small, and thus an isomorphism by Lemma 2.16. We conclude that A lies
in the interior of Nef(Z), completing the proof.

Lemma 2.18. Let pi : K 99K Zi be birational contractions over K such that Pic(Zi )R âŠ‚ Pic(K)R
give the same linear subspaces, for i = 1, 2. Then both pi have the same exceptional divisors; in
particular Z1 99K Z2 is small.
Let p : K 99K Z be a birational contraction with Z Q-factorial. Then Pic(Z)R âŠ‚ Pic(K)R is the
linear span of a face of Mov(K).
Proof. Observe that for a regular birational contraction f : Y â†’ Z of Q-factorial varieties, an
irreducible effective divisor E is in the base locus of |f âˆ— L âŠ— O(E)| for all L âˆˆ Pic(Z) if and only if
E is f -exceptional (using the projection formula). Thus the vector subspace Pic(Z)R âŠ‚ Pic(Y )R
determines the exceptional divisors of f . For each pi : K 99K Zi , up to replacing K by an SQM, we
can assume that pi is regular. So the first statement follows.
For the second: Let Î“ be the minimal face of Mov(K) containing Nef(Z), and suppose to the
contrary that Nef(Z) âŠ‚ Î“ is lower dimensional. Choose a maximal cone Nef(Z1 ) âŠ‚ Î“ containing
Nef(Z). Apply Lemma 2.17 T
to the regular birational contraction Z1 â†’ Z, and let Ei , Ci , i = 1, . . . , n
be as in that lemma, with i CiâŠ¥ âˆ© Nef(Z1 ) = Nef(Z). If all the Ci are non-negative on Î“, then

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

11

they cut out a proper face of Î“ containing Nef(Z), contradicting the minimality of Î“. Thus there
exists one Ci , another maximal cone Nef(Z2 ) âŠ‚ Î“ containing Nef(Z), and a rational point A in the
interior of Nef(Z2 ) with Ci Â· A < 0. Since Ci passes through a general point of Ei as in Lemma 2.17,
Ci Â· A < 0 implies that Ei lies in the base locus of A (viewed as a divisor on Z1 ). Note that Z1 99K Z2
is small by the first paragraph. This contradicts the assumption that A is ample on Z2 , completing
the proof.

Definition 2.19. For each maximal bogus cone b = f âˆ— Nef(Z) + hex(f )i corresponding to a
birational contraction f : K â†’ Z, let Î³b âˆˆ MovSec(K) be the minimal cone containing f âˆ— Nef(Z).
Two maximal bogus cones are said to be equivalent if they have the same Î³b .
Proposition 2.20. Equivalent maximal bogus cones have the same (associated) exceptional locus,
and same Pic(Z)R âŠ‚ Pic(K)R . For each maximal bogus cone b = f âˆ— Nef(Z) + hex(f )i, define
Î²b := Î³b + hex(f )i .
The cone Î²b and the above sum decomposition depend only on the equivalence class of b. Adding
the cones Î²b , over all (equivalence classes of) maximal bogus cones b, to MovSec(K) gives a finite
rational polyhedral fan Sec(K), called the secondary fan, which is a coarsening of MoriFan(K).


Proof. This follows from Lemma 2.18.

2.4. The secondary fan in the del Pezzo case. Here we apply the general construction of
secondary fan to the canoincal bundle over a del Pezzo surface, see Proposition 2.29 and Remark 2.30
for an explicit description. We begin with some general notations.
Notation 2.21. Let k be the field of complex numbers C. Let Y be a smooth Fano k-variety, and
D âŠ‚ Y a normal crossing anti-canonical divisor containing a 0-stratum. Let U := Y \ D, K â†’ Y
the canonical bundle, K Ã— := K \ Y , V := K Ã— |U , and P := P(K âŠ• O). Let K â†’ K and P â†’ P be
the contractions of the 0-sections. By [6, Cor. 1.3.1], Y , K/K and P/P are Mori dream spaces.
Lemma 2.22. The following hold:
(1) We have isomorphisms
pâˆ—

âˆ¼

Pic(Y ) âˆ’âˆ’â†’ Pic(K) âˆ’âˆ’â†’ Pic(K/K),
âˆ¼

pâˆ—

Pic(Y ) âˆ’âˆ’â†’ Pic(P/P),
âˆ¼

âˆ—

where p denotes pullback by projection.
âˆ¼
(2) Under the isomorphism Pic(P/P) âˆ’
â†’ Pic(K/K), MoriFan(P/P) is identified with MoriFan
(K/K).
(3) Under these isomorphisms, the cones Mov(K/K), Mov(P/P) and Eff(Y ) are identified.
(4) As fans on Mov(K/K) â‰ƒ Eff(Y ), MovFan(K/K) refines MoriFan(Y ). The two fans are
the same when Y has dimension two, (which we expect to hold in all dimensions).
pâˆ—

Proof. By [10, Theorem 3.3(a)], we have Pic(Y ) âˆ’â†’ Pic(K), with inverse given by sâˆ— , with s : Y â†’ K
âˆ¼

the 0-section. The map Pic(K) â†’ Pic(K/K) is surjective by definition. To see that it is injective,
take L âˆˆ Pic(K) which is equal to the pullback of a line bundle on K. Then sâˆ— L is a trivial line
bundle on Y , i.e. sâˆ— L = 0 âˆˆ Pic(Y ), so L = 0 âˆˆ Pic(K). Next, [10, Theorem 3.3(b)] shows that

12

PAUL HACKING, SEAN KEEL, AND TONY YUE YU
pâˆ—

Pic(Y ) âˆ’â†’ Pic(P) is injective, with retraction given by sâˆ— , with s : Y â†’ P the 0-section. Then the
pâˆ—

same argument above shows that Pic(Y ) âˆ’â†’ Pic(P/P) is an isomorphism. This shows (1).
Observe that P â†’ P and K â†’ K have the same exceptional locus Y , so (2) follows, as well as
the identification between Mov(K/K) and Mov(P/P). Moreover, since K is affine, Y is the only
possible base divisor for any L âˆˆ Pic(K); this implies the identification between Mov(K/K) and
Eff(Y ). So we obtain (3).
Next we show that Mori equivalence for K/K implies Mori equivalence for Y . Recall that two
effective divisors are Mori equivalent if they give rise to the same contraction and they have the
same stable base divisors (with reduced structure). Since the restriction H 0 (K, pâˆ— L) â†’ H 0 (Y, L)
is surjective (viewed as O(K)-module) for any L âˆˆ Eff(Y ), the contraction of K/K given by pâˆ— L
restricts to the contraction of Y given by L, and the base locus of pâˆ— L on K restricts to the base
locus of L on Y . Therefore, given L1 , L2 âˆˆ Eff(Y ), if pâˆ— L1 and pâˆ— L2 are Mori equivalent on K/K,
then L1 and L2 are Mori equivalent on Y . So MovFan(K/K) refines MoriFan(Y ). Finally, when Y
is 2-dimensional, the refinement is an equality by the explicit description in Lemma 2.28.

Remark 2.23. Let Î“ = Sk(V ) âˆ© K i be as in Construction 2.3. It can also be described by
tropicalization of divisors: Let Y0 and Yâˆž denote respectively the 0-section and the âˆž-section of
Ï€ : P = P(K âŠ• O) â†’ Y . Consider the divisor Î´ := Y0 âˆ’ Yâˆž . Then Î“ = { Î´ trop â‰¥ 0 } âŠ‚ Sk(V ) âŠ‚ V an .
By [24, Lemma 15.2], Î“ is the support of the sub cone complex Î£(V âŠ‚K) âŠ‚ Î£(V âŠ‚P) , generated by
the components of K \ V (see Definition 4.1 for dual (cone) complexes in the normal crossing case).
We denote by Î“ the induced cone complex structure on Î“.
The divisor D âŠ‚ Y , viewed as a section of the dual K âˆ— â†’ Y , gives a regular function d on
K. Note the principle divisor on P associated to d is equal to pâˆ— D + Î´. We have an isomorphism
âˆ¼
âˆ¼
p Ã— d: V âˆ’
â†’ U Ã— Gm which induces Sk(V ) âˆ’
â†’ Sk(U ) Ã— R (see [24, Proposition 8.8]), and
âˆ¼ 
(2.24)
Î“ âˆ’âˆ’â†’ (x, n) Dtrop (x) â‰¤ n âŠ‚ Sk(U ) Ã— Râ‰¥0 ,
together with the analogous bijections for the integer points.
Let

(2.25)
Î› := x âˆˆ Î“ dtrop (x) = 1 .
It projects to {Dtrop (x) â‰¤ 1} âŠ‚ Sk(U ). We have [Y ] âˆˆ Î›(Z), the divisorial valuation given by
Y âŠ‚ K. When (Y, D) is toric Fano, Î› is isomorphic to the dual reflexive polytope associated to Y .
By construction, we have Î“ â‰ƒ C(Î›), where C(Â·) denotes the cone. Then the cone complex Î“
induces a cell complex structure Î› on Î› (more precisely, a âˆ†-complex structure, see Definition 4.1).
Taking boundary, we have âˆ‚Î“ â‰ƒ Î£(V âŠ‚K Ã— ) â‰ƒ C(âˆ‚Î›).
Note K Ã— â†’ K is an open embedding, its complement is the point to which Y contracts under
K â†’ K. It follows that any birational contraction K 99K K 0 over K has exceptional locus contained
in Y , so it compactifies uniquely to a birational contraction P 99K P 0 . Moreover, we always have
K Ã— âŠ‚ K 0 , so the dual cone complex Î£(V âŠ‚K Ã— ) is a sub-complex of Î£(V âŠ‚K 0 ) , which is supported on
âˆ‚Î“.
Let T â†’ V denote the restriction of the universal torsor Ï€ : G â†’ K corresponding to the fixed
N âŠ‚ Pic(K), as in Construction 2.8. For any SQM K 99K K 0 over K, the restriction to V of the
e
corresponding torsor G0 â†’ K 0 is canonical identified with T , and we have a section Ï•K 0 : Î“ â†’ Î“,
e
where Î“ = Sk(T )|Î“ .
We will be omitting /K from the notations as in Assumption 2.7.

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

13

Lemma 2.26. The bogus cones of Sec(K) are exactly Î³ + Râ‰¥0 [Y ] âŠ‚ Eff(K) â‰ƒ Pic(K)R where Î³ is
a cone of MovSec(K) lying in the boundary Mov(K).
Proof. It suffices to observe that any divisorial contraction K 99K K 0 over K cannot contract any
divisor except Y âŠ‚ K.

e restricted to âˆ‚Î“âˆª{[Y ]} âŠ‚ Î“
Lemma 2.27. For any SQM K 99K K 0 over K, the section Ï•K 0 : Î“ â†’ Î“
is independent of the SQM.
Proof. Using Remark 2.11, it follows from the fact that K 99K K 0 is an isomorphism on K Ã— , as well
as on the generic point of Y âŠ‚ K.

Assume for the remainder of this section that Y is 2-dimensional.
Lemma 2.28. For any SQM b : K 99K K 0 over K, the following hold:
(1) The exceptional locus, ex(b), is a disjoint union of (âˆ’1)-curves in the zero section Y âŠ‚ K,
each of which has normal bundle O(âˆ’1) âŠ• O(âˆ’1) in K.
(2) The map b is the composition of (âˆ’1, âˆ’1)-flops of disjoint curves in ex(b), meaning that we
p1
blowup each curve C in ex(b), obtain an exceptional divisor E â‰ƒ P1 Ã— P1 âˆ’â†’ P1 â‰ƒ C, and
then blowdown by the second projection p2 . Moreover, K 0 is smooth.
b

(3) The rational map Y âŠ‚ K 99K K 0 is regular, the blowdown of the disjoint union of (âˆ’1)-curves
in ex(b). We denote Y 0 := b(Y ) âŠ‚ K 0 and bY : Y â†’ Y 0 .
(4) Let J âŠ‚ K 0 be the strict transform of pâˆ’1 (ex(b)) âŠ‚ K (where p : K â†’ Y is the projection).
Then the restriction of the rational map p : K 0 99K Y 0 to J c is regular, and is canonically
identified with the canonical bundle KY 0 â†’ Y 0 .
Proof. Since K â†’ K is an isomorphism outside the zero section Y âŠ‚ K, the exceptional locus ex(b)
lies in Y âŠ‚ K. Let L := bâˆ— A for an ample line bundle A on K 0 . By Lemma 2.22(1), L â‰ƒ pâˆ— LY
for a line bundle LY on Y . Since the restriction H 0 (K, pâˆ— L) â†’ H 0 (Y, L) is surjective (viewed as
O(K)-module), the contraction of K/K given by L restricts to the contraction of Y given by LY ,
denoted by bY : Y 99K Y 0 . Since b is small, bY is birational. Since Y is 2-dimensional, bY is regular.
By the genus formula, the exceptional locus of bY is a union of (âˆ’1)-curves. It is a disjoint union
because the intersection matrix of the irreducible components must be negative definite. Then by
the adjunction formula, the normal bundle NCâŠ‚K is isomorphic to O(âˆ’1) âŠ• O(âˆ’1). It follows from
the uniqueness of flop of a small contraction that b is the (âˆ’1, âˆ’1)-flop of these curves. This shows
statements (1-3).
Statement (4) follows from a simple explicit computation relating the flop to the elementary
transformation of the line bundle K â†’ Y along E := ex(b) âŠ‚ Y âŠ‚ K, which transforms it into
K âŠ— O(âˆ’E) â‰ƒ bâˆ—Y (KY 0 ).

Proposition 2.29. We call a (âˆ’1)-curve in Y either boundary or internal depending on whether
it is a component of D âŠ‚ Y . Each maximal cone of MovSec(K) is the union of maximal cones of
MovFan(K) corresponding to SQMs K 99K K 0 with the same set of boundary exceptional (âˆ’1)-curves.
The bogus cones of Sec(K) are described in Lemma 2.26.
Proof. By Remark 2.11, the flop of an internal (âˆ’1)-curve does not change Ï•. On the other hand by
Lemma 2.10, if we flop a boundary (âˆ’1)-curve C âŠ‚ Y âŠ‚ K, then Ï•([E]) changes, where [E] âˆˆ Î“(Z)
corresponds to the exceptional divisor for the blowup of C âŠ‚ K.


14

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Remark 2.30. We can then equivalently describe Sec(K) as a fan structure on Pic(Y )R . By
Lemma 2.22, the isomorphism Pic(K/K)R â‰ƒ Pic(Y )R identifies Mov(K) with Eff(Y ). Then each
maximal cone of MovSec(K) corresponds to the union of cones in Pic(Y )R of form f âˆ— Nef(Y 0 )+hex(f )i
over all divisorial contractions f : Y â†’ Y 0 with the same set of boundary exceptional (âˆ’1)-curves;
while each bogus cone of Sec(K) corresponds to a cone in Pic(Y )R of form Î³ + Râ‰¥0 [K] where Î³ lies
in the boundary âˆ‚ Eff(Y ) and is a cone of the fan we just made in Eff(Y ).
Example 2.31. Consider the case when Y is a del Pezzo of degree one. Then D âˆˆ | âˆ’ KY | is
irreducible, so there are no boundary (âˆ’1)-curve in Y . Thus by Proposition 2.29, MovSec(K)
has just a single maximal cone, Mov(K) = Eff(Y ), and Sec(K) is obtained by adding the cone
Î³ + Râ‰¥0 [Y ] âŠ‚ Eff(K) for each face Î³ of Mov(K).
3. Rephrasing the mirror algebra using the universal torsor
Let k be a field of characteristic 0, U a smooth affine log Calabi-Yau k-variety containing an
open split algebraic torus, and U âŠ‚ Y a normal crossing compactification. Let AY denote the
associated mirror algebra of [24]. It is a free module over the monoid ring RY := Z[NE(Y, Z)] with
basis Sk(U, Z), the integer points in the essential skeleton. Given P1 , . . . , Pn âˆˆ Sk(U, Z), n â‰¥ 2,
write the product in AY as
X
X
(3.1)
Î¸P1 Â· Â· Â· Î¸Pn =
Ï‡(P1 , . . . , Pn , Q, Î³)z Î³ Î¸Q .
QâˆˆSk(U,Z) Î³âˆˆNE(Y )

The structure constants Ï‡(P1 , . . . , Pn , Q, Î³) are given by counts of non-archimedean analytic disks
in the analytification U an with respect to the trivial valuation on k (see [24, Definition 1.5]).
Note that the mirror algebra involves two kinds of monomial-like objects: the theta function basis
Î¸P for P âˆˆ Sk(U, Z), and the coefficients z Î³ for Î³ âˆˆ NE(Y, Z). In this section, we will rephrase the
mirror algebra using the universal torsor over Y , see Theorem 3.5. In this way, we can incorporate
the second sort of monomials into the first sort. Such a reformulation will be necessary for comparing
and gluing mirror algebras over different birational models of Y .
As in [24, Remark 1.3], we can remove the independence of the mirror algebra AY on the
compactification Y by setting all curve classes to 0: we put AU := AY âŠ—RY Z, where RY â†’ Z sends
every z Î³ to 1.
Since Y contains an open algebraic torus, Pic(Y ) is a lattice. Given any sublattice N âŠ‚ Pic(Y ),
let M := N âˆ— , T N = TM , Ï€ : G â†’ Y , T := G|U , Sk(T ) â†’ Sk(U ) and Ï• : Sk(U ) â†’ Sk(T ) be as in
Construction 2.3. We have a natural projection Ï€M : N1 (Y, Z) â†’ M . Let S1 , . . . , Sm be a basis of
Ã—
N , then we have G â‰ƒ LÃ—
1 Ã— Â· Â· Â· Ã— Lm , where Li denotes the dual of Si . Let
f : [D, (p1 , . . . , pn , s)] âˆ’â†’ Y an
be a structure disk as in [24, Definition 14.5] defined over a discrete valuation field. Let Î· := âˆ‚D be
the Berkovich boundary point, Dâ—¦ := D \ {p1 , . . . , pn }, Î“ the convex hull of Î·, p1 , . . . , pn in D, and
Î“â—¦ := Î“ \ {p1 , . . . , pn }. By [8, Theorem 3.7.2] and [36, Tag 0BCH], all line bundles on D are trivial;
in particular, f âˆ— (Li ) is trivial for every i = 1, . . . , m. Let Ïƒi be a non-vanishing section of f âˆ— (Li ).
an
They give rise to a section Ïƒ : D â†’ f âˆ— (G). Composing with fiberwise retraction of TM
onto its
â—¦
t
skeleton, we obtain a section Ïƒ : Î“ â†’ Sk(T )|Î“â—¦ . Furthermore, the restriction of Ï• : Sk(U ) â†’ Sk(T )
gives a section Ï• : Î“â—¦ â†’ Sk(T )|Î“â—¦ . Thus we obtain a continuous function g : Ïƒ t âˆ’ Ï• : Î“â—¦ â†’ MR , as it
is the difference of two sections of an MR -principal bundle.
Lemma 3.2. We have
dÎ· (g) = Ï€M ([f : D â†’ Y an ]) âˆˆ M

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

15

where dÎ· denotes the derivative at Î· in the direction of the unique incident edge. Moreover d(g) is
zero near every pj .
Remark 3.3. Note that Ïƒ t depends on the choice of the non-vanishing sections Ïƒi . Nevertheless,
any other choice of Ïƒi differs by an invertible function on D, which has constant tropicalization by
the maximum modulus principle. Hence the derivative of Ïƒ t is independent of choices of Ïƒi . This
independence is also a consequence of Lemma 3.2.
Proof of Lemma 3.2. It is enough to prove the case when N has rank one, as both sides commute
with projection. So we may assume N is generated by a single line bundle S. Let L â†’ Y be the dual
line bundle. Note that the projection Ï€M : N1 (Y, Z) â†’ M is given by coupling with c1 (S) = âˆ’c1 (L).
So the statement (in this rank one case) is equivalent to
âˆ’dÎ· (g) = c1 (L) Â· [f : D â†’ Y an ].
Let f : C â†’ Ybkâ—¦ be a strictly semistable formal model of the structure disk up to passing to a
base field extension. We view Ïƒ as a rational section of fâˆ— (L) on C, and let F be the associated
Cartier divisor, which by assumption is supported on the central fiber. Taking valuation, we obtain
F trop : Î“â—¦ â†’ R (see [24, Construction 15.1]). Taking local trivialization of fâˆ— (L) and tracing through
the definitions, we have Ïƒ t âˆ’ Ï• = F trop on Î“â—¦ . Since F is supported on the central fiber, F trop is
constant on Î“â—¦ near every pj by [24, Lemma 15.2], and thus its derivative is zero near every pj . Now
the result follows from [24, Lemma 15.3].

Definition 3.4. We say a point P âˆˆ Sk(T , Z) is M 0 -above Ï•, for some monoid M 0 âŠ‚ M , if
P âˆ’ Ï•(Ï€(P )) âˆˆ M 0 .
We consider the mirror algebra AT for T with all curve classes set to 0, this is independent of
any compactification T âŠ‚ T . Comparing with the base extension AY âŠ—RY Z[M ], we note there is a
âˆ¼
canonical identification of their Z-bases under Sk(U ) Ã— M âˆ’
â†’ Sk(T ), sending (P, Î³) 7â†’ Ï•(P ) + Î³.
Let NE(Y )M âŠ‚ M denote the image of NE(Y, Z) under the projection Ï€M : N1 (Y, Z) â†’ M .
Theorem 3.5. The above identification of free Z-modules gives an isomorphism of rings, AY âŠ—RY
âˆ¼
Z[M ] âˆ’
â†’ AT . The image of AY âŠ—RY Z[NE(Y )M ] is the sub-Z-module of AT spanned by the basis
elements Î¸P over all P âˆˆ Sk(T , Z) that are NE(Y )M -above Ï•.
Proof. The ring isomorphism in the theorem follows from the two equalities below:
(1) For any P âˆˆ Sk(U, Z), Î±, Î² âˆˆ M ,
Î¸Ï•(P )+Î± Â· Î¸Ï•(0)+Î² = Î¸Ï•(P )+Î±+Î² ,
(2) For any P1 , P2 , Q âˆˆ Sk(U, Z), Î³ âˆˆ M ,
X
X
Ï‡(P1 , P2 , Q, Î³ 0 ) =
Î³ 0 âˆˆNE(Y,Z)
Ï€M (Î³ 0 )=Î³

Ï‡(Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´).

Î´âˆˆNE(T ,Z)

Fix an open algebraic torus T âŠ‚ U . Choose an snc compactification T âŠ‚ T so that Ï€ : T â†’ U
an
extends to Ï€ : T â†’ Y . For statement (1): Let f : [D, (p1 , p2 , s)] â†’ T
be a general structure
disk responsible for any structure constant for the multiplication Î¸Ï•(P )+Î± Â· Î¸Ï•(0)+Î² in AT , see [24,
Definition 14.5]. Let g be the composition of f with Ï€ : T â†’ Y . Then g is a structure disk responsible
for a structure constant for the multiplication Î¸P Â· Î¸0 in AY . So the spine in Sk(U ) associated to g
is disjoint from any walls (with respect to the fixed open algebraic torus T âŠ‚ U ). In particular, the
spine does not have any bending points, and there are no twigs attached. It follows that the image

16

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

g(D \ p1 ) lies in T an âŠ‚ U an , hence the image f (D \ p1 ) lies in Ï€ âˆ’1 (T )an where Ï€ : T â†’ Y . Now the
equality (1) follows from the multiplication rule in the toric case, see [24, Lemma 9.4].
Next we prove statement (2): Applying [24, (14.2)] (and its notation) to U âŠ‚ Y , P1 , P2 , Q âˆˆ
Sk(U, Z) and Î³ 0 âˆˆ NE(Y, Z), we obtain
Î¦an

N (U âŠ‚ Y, P1 , P2 , Q, Î³ 0 ) âˆ’âˆ’âˆ’â†’ VM Ã— VQ âŠ‚ (M0,4 Ã— U )an ,
whose degree gives Ï‡(P1 , P2 , Q, Î³ 0 ). Similarly, applying to T âŠ‚ T , Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³ âˆˆ Sk(T , Z)
and Î´ âˆˆ NE(T , Z), we obtain
 Î¨an
N T âŠ‚ T , Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´ âˆ’âˆ’âˆ’âˆ’â†’ VM Ã— VÏ•(Q)+Î³ âŠ‚ (M0,4 Ã— T )an ,
whose degree gives Ï‡(Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´).
Pick any Âµ âˆˆ VM and let
b := (Âµ, Ï•(Q) + Î³) âˆˆ VM Ã— VÏ•(Q)+Î³ âŠ‚ (M0,4 Ã— T )an .
Make a base field extension so that k becomes algebraic closed and b âˆˆ (M0,4 Ã— T )an (k). Then by
[24, Lemma 9.11], the fiber

N T âŠ‚ T , Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´ b
is just a finite set, whose cardinality gives Ï‡(Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´). The point b projects to a
point b0 âˆˆ (M0,4 Ã— U )an (k), and the fiber
N (U âŠ‚ Y, P1 , P2 , Q, Î³ 0 )b0
is also a finite set, whose cardinality gives Ï‡(P1 , P2 , Q, Î³ 0 ).
By Lemma 3.2, the projection Ï€ : T â†’ U induces a map
a

N T âŠ‚ T , Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´ b
Î :
Î´âˆˆNE(T ,Z)

âˆ’â†’

a

N (U âŠ‚ Y, P1 , P2 , Q, Î³ 0 )b0 .

Î³ 0 âˆˆNE(Y,Z)
Ï€M (Î³ 0 )=Î³

Now it remains to show that Î  is a bijection. We construct the inverse of Î  as follows. Let
S1 , . . . , Sm be a basis of Pic(Y ), and let Li denote the dual of Si . Let
[C, (p1 , p2 , z, s), f : C â†’ Y an ] âˆˆ N (U âŠ‚ Y, P1 , P2 , Q, Î³ 0 )b0 ,
with Î³ 0 âˆˆ NE(Y, Z), Ï€M (Î³ 0 ) = Î³. For every i = 1, . . . , m, we choose a rational section Ïƒi of f âˆ— Li
whose associated divisor is supported at z; note the choice is unique up to multiplication by a scalar
an
in k Ã— . The rational sections induce a lift Ïƒ(f ) : C â†’ T , and we choose the scalars uniquely so that
an
Ïƒ(f )(s) = b. Note that Ïƒ(f )(C \ z) âˆˆ G (where G â†’ Y is the torsor associated to N âŠ‚ Pic(Y )).
Then Lemma 3.2 implies

Ïƒ(f ) âˆˆ N T âŠ‚ T , Ï•(P1 ), Ï•(P2 ), Ï•(Q) + Î³, Î´ b
for a unique Î´ âˆˆ NE(T ). The assignment f 7â†’ Ïƒ(f ) gives the inverse of Î , completing the proof. 
Remark 3.6. We note that in [24, Remark 17.7], the mirror algebra is defined for any normal
projective compactification U âŠ‚ Y , not necessarily snc. Theorem 3.5 holds as stated in that
generality. Indeed, the mirror algebra in general is constructed by choosing an snc resolution
q : Ye â†’ Y which is an isomorphism over U , and then taking AY := AYe âŠ—RY RYe (which turns out

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

17

to be independent of the resolution). We pullback the universal torsor G â†’ Y to Ye . Note that T
(and in particular, AT ) does not change. So the result for Ye implies the result for Y .
4. Central fiber as an umbrella
In this section we describe the central fiber of the affine mirror family as the spectrum of a
(generalized) Stanley-Reisner ring, which we call an umbrella. This explicit description will be useful
in the proof of the main theorem.
We continue the setting of Section 3, where U is a smooth affine log Calabi-Yau variety containing
an open split algebraic torus, U âŠ‚ Y a normal crossing compactification, and D := Y \ U . We have
the mirror algebra AY from [24] over the monoid ring RY := Z[NE(Y, Z)]. Let V := Spec AY and V0
the fiber over the unique 0-stratum of the base toric variety TV(Nef(Y )) â‰ƒ Spec RY , which is given
by the maximal monomial ideal mY in RY . Our goal here is to compute the fiber V0 .
First let us define the dual complex âˆ†(E) of any normal crossing divisor E âŠ‚ Y , which generalizes
the usual dual complex in the simple normal crossing case. We use the terminology of âˆ†-complex
from [20, Â§2.1], which is a generalization of simplicial complex.
Definition 4.1. A stratum of E is an irreducible component of an iterated singular locus Sing(. . .
Sing(E)) of E. We take an n-simplex for each codimension-n stratum of E, and glue them according
to the way the strata of E fit together. The resulting âˆ†-complex âˆ†(E) is call the dual complex of
E. Let âˆ†0 (E) denote the collection of simplexes before the gluing. Let Î£(Y,E) denote the cone over
âˆ†(E), and similarly for Î£0(Y,E) . We call Î£(Y,E) the dual cone complex.
Definition 4.2. Let Dess âŠ‚ D be the union of essential divisors, i.e. irreducible components where
the volume form has a pole. Let S 0 be the Stanley-Reisner ring for âˆ†0 (Dess ) (see [32, Definition 1.6]).
As an abelian group, it is free with basis the integer points Î£0(Y,Dess ) (Z). Let q : Î£0(Y,Dess ) â†’ Î£(Y,Dess )
denote the quotient map. Let S âŠ‚ S 0 be the subgroup with bases
X
Î¸P :=
Î¸P 0
P 0 âˆˆq âˆ’1 (P )

over all P âˆˆ Î£(Y,Dess ) (Z). We call Spec S an umbrella.
Proposition 4.3. We have AY âŠ—RY RY /mY â‰ƒ S, identifying the basis elements via the canonical
isomorphism Sk(U, Z) â‰ƒ Î£(Y,Dess ) (Z).
In order to prove Proposition 4.3, we need to compute the multiplication rule on AY âŠ—RY RY /mY .
The only structure disks which contribute (modulo mY ) have zero curve classes. From [24, Definition
7.1], the spine associated to a general structure disk of class 0 must map to the interior of a maximal
cell of Î£(Y,D) and must be balanced. So Proposition 4.3 follows from the following:
Proposition 4.4. Let h : Î“ â†’ Sk(U ) be a spine in the essential skeleton Sk(U ) (see [24, Definition
9.1]). Assume that h(Î“) âˆ© Sk(U ) lies in the interior of a maximal cell of Î£(Y,Dess ) , and that h is
balanced (at the interior vertices of Î“). Then the count N (h, 0) = 1, and N (h, Î³) = 0 for all Î³ 6= 0.
The two propositions above hold under [24, Assumption 2.4] by Proposition 15.12 (see also
Lemmas 9.4 and 14.7) in loc. cit.. It is possible to remove that Assumption 2.3, but for the simplicity
of exposition and for the purpose of this paper, let us explain only the 2-dimensional case, which is
the content of Proposition 4.7.

18

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

4.1. Counts of balanced spines in dimension two. In this subsection, we assume moreover
that U is 2-dimensional. Recall that any minimal snc compactification U âŠ‚ Y gives a Berkovich
retraction Ï„ : U an â†’ Sk(U ). The retraction does not change if we blowup 0-strata of D, and any
two minimal snc compactifications of U are related by such blowups. Therefore the retraction Ï„ is
canonical. Moreover, the retraction is an affinoid torus fibration outside 0 âˆˆ Sk(U ), which induces a
canonical Z-affine structure on Sk(U ) \ 0 (see [38, Proposition 3.6], see also [34]).
Lemma 4.5. Let E âˆˆ Sk(U, Z) be a non-zero primitive integer point. Then there is an snc
compactification U âŠ‚ Y where E has divisorial center, and a toric model (see [12, Definition 1.18])
Ï€ : Y â†’ Y whose exceptional locus is disjoint from (the divisor corresponding to) E.
Proof. Let TM âŠ‚ U be an open algebraic torus with cocharacter lattice M . The choice identifies
Sk(U, Z) â‰ƒ Sk(TM , Z) â‰ƒ M . Let TM âŠ‚ Y be a toric compactification with a ruling Y â†’ P1 ,
on which (the boundary divisors corresponding to) E, âˆ’E âˆˆ M are disjoint sections. Then after
replacing Y by a toric blowup (i.e. refining the fan), there is a minimal snc compactification U âŠ‚ Y ,
such that E has divisorial center (which we denote also by E), Ï€ : Y 99K Y is regular, and no
component of D := Y \ U is Ï€-exceptional. Suppose there is a Ï€-exceptional divisor meeting E at
p. Let Y 0 be the elementary transformation of Y â†’ P1 at Ï€(p) (i.e. blowup Ï€(p) and blowdown
the strict transform of the fiber through Ï€(p)), which is again toric (but for a different copy of
TM âŠ‚ U ). Then Ï€ 0 : Y 99K Y 0 is again regular, but there is no Ï€ 0 -exceptional divisor meeting E at p.
We replace Y by Y 0 and repeat the process until the Ï€-exceptional locus is disjoint from E.

Our main interest in Lemma 4.5 is:
Lemma 4.6. There is a finite covering of Sk(U ) \ 0 by open cones, such that Ï„ âˆ’1 of each cone
is contained in T an âŠ‚ U an for some open algebraic torus T âŠ‚ U , where Ï„ : U an â†’ Sk(U ) is the
canonical retraction (in dimension two).
Proof. For any non-zero primitive integer point E âˆˆ Sk(U, Z), let Ï€ : Y â†’ Y be as in Lemma 4.5,
and let star(E) be the union of open cones of Î£(Y,D) whose closure contains E. Then Lemma 4.5
implies that Ï„ âˆ’1 (star(E)) âŠ‚ T an , for T the structure torus of Y . All such star(E) cover Sk(U ) \ 0,
and we extract a finite covering by compactness.

Proposition 4.7. Fix an snc compactification U âŠ‚ Y with D := Y \ U . Let h : Î“ â†’ Sk(U ) be a
spine in Sk(U ) (see [24, Definition 9.1]). Assume it is transverse to the dual cone complex Î£(Y,D) .
Let f : C â†’ Y an be a map from a compact quasi-smooth curve such that the associated spine is
h. Let Z(f ) âˆˆ Z1 (Y ) be the algebraic 1-cycle associated to f as in [24, Definition 7.1]. Then h is
balanced (at the interior vertices) with respect to the Z-affine structure on Sk(U ) \ {0} if and only if
Z(f ) is supported on boundary 1-strata of Y .
Next assume h is balanced (at the interior vertices). Define
X
Z(h) :=
|dx h âˆ§ eh(x) |Zh(x) âˆˆ Z1 (Y ),
xâˆˆhâˆ’1 (Î£1(Y,D) )

where Î£1(Y,D) âŠ‚ Î£(Y,D) denotes the union of 1-dimensional cones, dx h denotes the derivative at x,
eh(x) denotes the primitive integral vector on the ray containing h(x), |Â·| denotes the lattice length
of the wedge product, and Zh(x) denotes the boundary 1-stratum of Y corresponding to the ray

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

19

containing h(x). Then the count
(
N (h, Î³) =

1
0

if Î³ = Z(h) âˆˆ NE(Y, Z),
.
otherwise.

Proof. Since 0 âˆˆ Sk(U ) is the only singularity of the Z-affine structure, the spine h is balanced (at
the interior vertices) if and only if the tropical curve associated to f has no twigs (i.e. branches
attached to the spine). Since only twigs can contribute to components of Z(f ) not supported on
boundary 1-strata of Y , we deduce the first assertion of the proposition.
For the second assertion, using the gluing formula ([24, Theorem 12.4]), we can cut h into small
pieces, and then by Lemma 4.6, we can assume Ï„ âˆ’1 (h(Î“)) âŠ‚ T an for an open algebraic torus T âŠ‚ U ,
where Ï„ : U an â†’ Sk(U ) is the canonical retraction map. Then the spine h is also balanced with
respect to the Z-affine structure given by T , so we can conclude by [24, Lemma 9.4] using this torus
T.

Let us deduce a corollary from Proposition 4.7 which will be useful in Section 8.1.
Definition 4.8. We say an effective algebraic 1-cycle Î± on a projective variety is rigid if it is the
only effective cycle in its numerical equivalence class.
Corollary 4.9. Notation as in Proposition 4.7. Let Î³ be a rigid algebraic 1-cycle supported on
boundary 1-strata of D. If the count N (h, Î³) 6= 0, then h is balanced and Î³ = Z(h). In this case,
N (h, Î³) = 1.
Proof. Since Î³ is rigid, if f contributes to N (h, Î³) then the algebraic 1-cycle Z(f ) associated to f is
necessarily Î³. Now the corollary follows from Proposition 4.7.

We remark that in the 2-dimensional case, Proposition 4.3 can also be deduced from [12] via the
following comparison result:
Proposition 4.10. For (Y, D) 2-dimensional, our mirror algebra AY coincides with the mirror
algebra of [12].
Proof. This follows from the non-degeneracy of the Frobenius pairing (see [24, Theorem 1.2(1)]),
and the comparison of Frobenius pairings (see [31, Prop. 6.1], the issue is the equality between
certain virtual and naive relative Gromov-Witten invariants).

5. Toric fiber bundles
In this section we describe a general construction of toric stacks that will be used in Section 6.4.
Along the way, we correct a mistake in [9] concerning toric fiber bundles.
Notation 5.1. We denote by TV(âˆ†, N ) the toric scheme (over Z) given by a fan âˆ† in a lattice N ,
writing TV(âˆ†) if there is no ambiguity about N . We denote by TN the algebraic torus (over Z)
with cocharacter lattice N . We denote by TV(âˆ†, N )C and TN,C the base changes to C. We will
build the mirror family over Z in Section 6, but will need to base change everything to C in Sections
7 and 8, where the subscript C denoting the base change will be dropped (cf. Notation 8.1).
Construction 5.2. Let âˆ† be a rational polyhedral fan in a lattice N and âˆ†0 âŠ‚ âˆ† a subfan. Let
L âŠ‚ N be a subgroup (the quotient N/L is not necessarily torsion-free). Assume that for each
Ïƒ âˆˆ âˆ†, we have Ïƒ = Ïƒ1 + Ïƒ2 where Ïƒ1 âŠ‚ LR , Ïƒ2 âˆˆ âˆ†0 , and LR âˆ© hÏƒ2 iR = 0 (so that in particular
Ïƒ1 Ã— Ïƒ2 â†’ Ïƒ is a bijection).

20

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Note that Ïƒ1 , Ïƒ2 can be recovered from Ïƒ, i.e. Ïƒ1 = Ïƒ âˆ© LR , and Ïƒ2 âŠ‚ Ïƒ is the unique face
containing every face whose span has zero intersection with LR . The collection of cones Ïƒ1 âŠ‚ LR
over all Ïƒ âˆˆ âˆ† forms a fan âˆ†L in L; and the analogous collection of Ïƒ2 âŠ‚ NR forms a subfan of âˆ†0 .
e be the collection of cones Ïƒ1 + Ïƒ2 âŠ‚ N
e := L âŠ• N , and let âˆ†
eR , together with their faces. This
Let N
0
is a subfan of the product fan âˆ†L Ã— âˆ† .
We have an exact sequence
a

b

0â†’Lâˆ’
â†’LâŠ•N â†’
âˆ’ N â†’0
e N
e )/TL ] as a stack where we
where a(l) = (âˆ’l, l) and b(l, n) = l + n. Define T V(âˆ†, N ) := [TV(âˆ†,
use the inclusion
TL âŠ‚ TL Ã— TN , t 7â†’ (tâˆ’1 , t)
e â†’ âˆ†, and so a map TV(âˆ†,
e N
e ) â†’ TV(âˆ†, N ). This
induced by a. The map b gives a map of fans âˆ†
is TL -invariant by the exact sequence and so induces
e N
e )/TL ] âˆ’â†’ TV(âˆ†, N ).
b : T V(âˆ†, N ) = [TV(âˆ†,
e â†’ âˆ†0 , and so a map Ï€N : TV(âˆ†,
e N
e = L âŠ• N â†’ N gives a map of fans âˆ†
e) â†’
The projection N
0
e
TV(âˆ† , N ). This is TL -equivariant (where L âŠ‚ N via a) and so induces a canonical representable
map
e N
e )/TL ] âˆ’â†’ [TV(âˆ†0 , N )/TL ].
Ï€ N : T V(âˆ†, N ) = [TV(âˆ†,
Proposition 5.3. The following hold:
(1) T V(âˆ†, N ) is a Deligne-Mumford stack, and b : T V(âˆ†, N ) â†’ TV(âˆ†, N ) is its coarse moduli
space.
(2) The map b is an isomorphism over TV(âˆ†0 , N ) âŠ‚ TV(âˆ†, N ).
(3) The composition
Ï€

N
TV(âˆ†0 , N ) âŠ‚ T V(âˆ†, N ) âˆ’âˆ’âˆ’
â†’ [TV(âˆ†0 , N )/TL ]

is the canonical quotient map.
eR be a cone and Ïƒ âŠ‚ NR its image under bR . Assume Ïƒ
Proof. Let Ïƒ
eâŠ‚N
e âˆ© a(L)R = 0 so that Ïƒ
eâ†’Ïƒ
e
is a bijection. Then TL acts with finite stabilizers on TV(e
Ïƒ , N ), and the coarse moduli space is
TV(Ïƒ, N ). This shows (1).
For (2), observe that
e ) â‰ƒ TL Ã— TV(âˆ†0 , N ),
bâˆ’1 (TV(âˆ†0 , N )) â‰ƒ TV({0} Ã— âˆ†0 , N
so TL acts freely on bâˆ’1 (TV(âˆ†0 , N )), hence (2) holds. (3) is obvious.



Remark 5.4. If we replace L by a finite index subgroup L0 âŠ‚ L, then the quotient stack T V(âˆ†, N ) =
e N
e )/TL ] will change, while its coarse moduli space TV(âˆ†, N ) stays the same.
[TV(âˆ†,
e N
e ) corresponding to a cone
Remark 5.5. The stabilizer A along the toric stratum of TV(âˆ†,
e
Ïƒ
e = Ïƒ1 Ã— Ïƒ2 âˆˆ âˆ† is the kernel of the composition
TL â†’ TL Ã— TN â†’ TL/N1 Ã— TN/N2
where N1 âŠ‚ L and N2 âŠ‚ N are the subgroups generated by Ïƒ1 âˆ© L and Ïƒ2 âˆ© N respectively. Thus
A â‰ƒ TN1 âˆ© TN2 âŠ‚ TN .

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

21

If we base change to C, the group AC is isomorphic to the torsion group of the quotient N/(N1 âŠ•N2 )
(recall that by assumption N1 âˆ© N2 = {0}). Indeed, applying (Â·) âŠ—Z CÃ— to the exact sequence
0 â†’ N1 âŠ• N2 â†’ N â†’ N/(N1 âŠ• N2 ) â†’ 0
gives
AC â‰ƒ Tor1Z (N/(N1 âŠ• N2 ), CÃ— ) â‰ƒ Tors N/(N1 âŠ• N2 ).
The following corollary corrects a mistake in the toric fiber bundle construction of [9, p. 41]. The
fiber bundle claim in loc. cit. is wrong when the stabilizer group in Remark 5.5 is non-trivial.
Corollary 5.6. Let 0 â†’ L â†’ N â†’ N â†’ 0 be a short exact sequence of lattices, and let âˆ†L , âˆ† and
âˆ† be fans in L, N and N respectively that are compatible with the maps of lattices. Suppose there is a
fan âˆ†0 in N that lifts âˆ† such that the cones Ïƒ âˆˆ âˆ† are exactly Ïƒ1 +Ïƒ2 with Ïƒ1 âˆˆ âˆ†L and Ïƒ2 âˆˆ âˆ†0 . Then
we may apply Construction 5.2. In this case, the stack [TV(âˆ†0 , N )/TL ] is a Deligne-Mumford stack
with coarse moduli space TV(âˆ†, N ), and the representable map Ï€ N : T V(âˆ†, N ) â†’ [TV(âˆ†0 , N )/TL ]
is a TV(âˆ†L , L)-bundle (for the Ã©tale topology).
Proof. Since L âˆ© âˆ†0 = 0, TL acts with finite stabilizers on TV(âˆ†0 , N ) and the quotient stack
[TV(âˆ†0 , N )/TL ] is a Deligne-Mumford stack with coarse moduli space TV(âˆ†, N ). Next, note that
e N
e ) â†’ TV(âˆ†0 , N ) is a TV(âˆ†L , L)-bundle (for the Zariski
the TL -equivariant morphism Ï€N : TV(âˆ†,
topology), which is trivial over TV(Ïƒ, N ) for each cone Ïƒ âˆˆ âˆ†0 . Taking quotient by TL on both
sides, we deduce the second statement of the corollary, completing the proof.

Corollary 5.7. Notation as in Proposition 5.3, consider the TL -action on T V(âˆ†, N ) â†’ TV(âˆ†, N )
induced by L ,â†’ L âŠ• N , l 7â†’ (0, l). Then any TL -equivariant family of varieties X 0 â†’ TV(âˆ†0 , N )
extends to a TL -equivariant representable morphism X â†’ T V(âˆ†, N ) of Deligne-Mumford stacks,
where
X := T V(âˆ†, N ) Ã—[TV(âˆ†0 ,N )/TL ] [X 0 /TL ].
Furthermore, assume there is a TL -equivariant line bundle L0 â†’ X 0 with a section Ïƒ 0 which is a
TL -eigensection of weight Ï‡ âˆˆ Lâˆ— . Then there is a line bundle L â†’ X extending L0 , and Ïƒ 0 extends
to a section of L if Ï‡ âˆˆ H 0 (TL , O) extends to TV(âˆ†L , L).
Proof. By the TL -equivariance, X 0 â†’ TV(âˆ†0 , N ) is pulled back from [X 0 /TL ] â†’ [TV(âˆ†0 , N )/TL ].
Therefore, the formula of X in the corollary gives the required extension.
e N
e)
The same construction works for the total space of L0 â†’ X 0 . Recall the projection Ï€N : TV(âˆ†,
0
0
âˆ—
0
0
e
e
â†’ TV(âˆ† , N ). If Ï‡ âˆˆ H (TL , O) extends to TV(âˆ†L , L), we define Ïƒ
e := Ï€N (Ïƒ ) Â· Ï‡ âˆˆ H TV(âˆ†, N ),

âˆ— 0
e via a), so it descends to a section Ïƒ âˆˆ H 0 (T V(âˆ†, N ), L),
Ï€N
L . This is TL -invariant (where L âŠ‚ N
which by construction extends the given section Ïƒ 0 .

6. The mirror family over the toric variety for the secondary fan
In this section we construct the mirror family over the toric variety for the secondary fan Sec(K).
First we construct the mirror algebra AKÎ± for every SQM K 99K KÎ± (see Proposition 6.1), and
we relate AK with AY in Proposition 6.7. Next we glue the mirror algebras AKÎ± to get a family
over the toric variety for MovSec(K), the moving part of the secondary fan. This is achieved by
rephrasing the mirror algebras using universal torsor as in Section 3. Finally we extend the mirror
family over the toric variety for the full secondary fan, using the equivariant boundary torus action,
as well as the toric fiber bundle construction of Section 5.

22

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

6.1. The mirror algebra for K. We follow Notation 2.21 and Remark 2.23. We have natural
identifications
NE(Y, Z) â‰ƒ NE(K, Z) â‰ƒ NE(P/P, Z) âŠ‚ NE(P, Z)
generated by curves on Y â‰ƒ Y0 âŠ‚ P, and so natural subrings
RY := Z[NE(Y, Z)] â‰ƒ RK := Z[NE(K, Z)] âŠ‚ Z[NE(P, Z)].
For any SQM K 99K KÎ± over K, we denote RKÎ± := Z[NE(KÎ± , Z)].
Proposition 6.1. For any SQM K 99K KÎ± over K, consider the multiplication rule for the mirror
algebra APÎ± associated to V âŠ‚ PÎ± . For any P1 , . . . , Pn âˆˆ Î“(Z), Q âˆˆ Sk(V, Z) and Î³ âˆˆ NE(PÎ± , Z)
such that the structure constant Ï‡(P1 , . . . , Pn , Q, Î³) 6= 0, we have Q âˆˆ Î“(Z) âŠ‚ Sk(V, Z) and
Î³ âˆˆ NE(KÎ± , Z) âŠ‚ NE(PÎ± , Z). Consequently, the free RKÎ± -submodule of APÎ± with basis Î¸P , P âˆˆ Î“(Z)
is an RKÎ± -subalgebra, which we denote by AKÎ± .
For the proof, we introduce Lemmas 6.2-6.6.
Lemma 6.2. Let C be a connected quasi-smooth k-analytic curve and f1 , . . . , fn regular functions
on C. Let F := mini {âˆ’ log|fi |} : C â†’ (âˆ’âˆž, +âˆž]. Let S âŠ‚ C be the convex hull of âˆ‚C. If F |S is
not constant, then there exists a point v âˆˆ âˆ‚C and an edge of S connected to v such that F achieves
its minimum at v and that the derivative dv F |e > 0.
Proof. Denote Fi := âˆ’ log|fi |. By [7, (4.5.21)], there exists a subgraph Î“ âŠ‚ C containing S such
that each Fi is balanced (aka harmonic) at every finite vertex v of Î“ \ âˆ‚C, i.e.
X
dv Fi |e = 0
e3v

summing over all edges of Î“ containing v. Hence
X
(6.3)
dv F |e â‰¤ 0.
e3v

By the maximum modulus principle, F achieves its minimum Fmin at âˆ‚C. Let T âŠ‚ S be the locus
where F |S = Fmin . Since F |S is not constant, there exists a domain of affineness e âŠ‚ S of F |S with
one endpoint v âˆˆ T and another endpoint w âˆˆ
/ T . Then by (6.3), v belongs to âˆ‚C, completing the
proof.

Lemma 6.4. Notation as in Lemma 6.2. Assume C is rational. Fix r âˆˆ âˆ‚C and assume that for
any v âˆˆ âˆ‚C \ r and any edge e of S containing v, we have dv F |e â‰¤ 0. Then F is non-decreasing
along any simple path from r to any x âˆˆ S. In particular F attains its minimum at r.
Proof. Since F is piecewise affine on S, it suffices to prove that for any domain of affineness e of F |S ,
the derivative of F |e pointing away from r is non-negative. Choose any point v in the interior of e
and cut S at e. Since C is rational, S is a tree, so we obtain two parts S1 and S2 , say S1 3 r. Let
e2 be the edge of S2 containing v. Then it suffices to show that the derivative dv F |e2 â‰¥ 0. Let C2
be the preimage of S2 by the retraction map C â†’ S. We achieve the proof by applying Lemma 6.2
to C2 .

Lemma 6.5. Assume k has non-trivial valuation, let C be a rational semistable formal curve over
the ring of integers k â—¦ and C := CÎ· . Let L be a line bundle on C and t a nonzero rational section of
L that is regular on C. Note that F := âˆ’ log|t| : C â†’ (âˆ’âˆž, +âˆž] is well-defined, since different local
trivializations of L do not change the norm |t|. Let S âŠ‚ C be the convex hull of âˆ‚C and fix r âˆˆ âˆ‚C.
Assume that Lâˆ— is semi-ample, and that for any v âˆˆ âˆ‚C \ r and any edge e of S containing v, we

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

23

have dv F |e â‰¤ 0. Then F is non-decreasing along any simple path from r to any x âˆˆ S. In particular
F attains its minimum at r.
Proof. Since Lâˆ— is semi-ample, some positive tensor power of L is a subbundle of a trivial vector
bundle. Since we can replace t by a positive tensor power without changing the maximum locus
of |t|, we may assume that L âŠ‚ OCm . Then t : OC 99K L âŠ‚ OCm is given by m rational functions
t1 , . . . , tn on C. Note that |t| = max|ti | on C, so the result follows from Lemma 6.4.

Lemma 6.6. Given P1 , . . . , Pn , Q âˆˆ Î“(Z) and Î³ âˆˆ NE(PÎ± , Z). Let
f : [D, (p1 , . . . , pn , s)] âˆ’â†’ PÎ±an
be a structure disk contributing to Ï‡(P1 , . . . , Pn , Q, Î³) defined over a field with discrete valuation
such that f (s) is a general rational point in Î“ near Q. Let C be D minus n small open disks centered
at p1 , . . . , pn respectively. Up to passing to a finite base field extension, let C be a strictly semistable
\
formal model of C such that f |C extends to f : C â†’ (P
Î± )kâ—¦ . Then fs (Cs ) âŠ‚ KÎ± âŠ‚ PÎ± .
Proof. Since the exceptional locus of P 99K PÎ± is contained in Y âŠ‚ K, it suffices to prove the lemma
for KÎ± = K. We apply Lemma 6.5 to C and the pullback of the Cartier divisor Î´ (notation as
in Remark 2.23). The conditions of the lemma on dv F (notation from the lemma) are satisfied
because P1 , . . . , Pn âˆˆ Î“(Z). Let r be the Gauss point of D. By [24, Lemma 8.22], we have
f (r) = f (s) = Q âˆˆ Î“(Z). Therefore, Lemma 6.5 implies that f |C : C â†’ V an has image in
{|Î´| â‰¤ 1} âŠ‚ V an . Hence the pullback of Î´ to C is effective. As the zeros and poles of Î´ = Y0 âˆ’ Yâˆž
on P are disjoint, we deduce that fs (Cs ) âŠ‚ K = P \ Yâˆž .

Proof of Proposition 6.1. By [24, Lemma 8.21(1)], the structure disks miss any codimension two
subset of KÎ± , so it suffices to prove Q âˆˆ Î“(Z) for KÎ± = K. Since âˆ’K is ample on Y , the divisors âˆ’Y0
and Yâˆž are nef on P, in particular âˆ’Î´ is nef on P. Then it follows from [24, Theorem 15.7(2)] that
Q âˆˆ Î“(Z). Next we apply Lemma 6.6, by choosing C sufficiently close to D. By [24, Lemma 14.6], Î³
is equal to the pushforward fs,âˆ— of the proper part of Cs . We conclude that Î³ âˆˆ NE(KÎ± , Z).

Next let us relate the two mirror algebras AK and AY . Notation as in Remark 2.23, dtrop : Sk(V, Z)
â†’ Z gives an N-grading on the RK -algebra AK . We denote X := Proj(AK ). The divisor D âŠ‚ Y
gives a filtration on AY with Aâ‰¤n having basis Î¸P , Dtrop (P ) â‰¤ n. By [24, Theorem 15.7(2)], we
eY âŠ‚ AY [T ], having basis Î¸P Â· T n
have Aâ‰¤m Â· Aâ‰¤n âŠ‚ Aâ‰¤m+n . So we obtain a graded RY -algebra A
with Dtrop (P ) â‰¤ n.
eY induced by (2.24) is an
Proposition 6.7. The isomorphism of graded RY -modules AK â‰ƒ A
isomorphism of graded RY -algebras.
Proof. The same argument in the proof of Theorem 3.5 shows that the isomorphism of graded
RY -modules is compatible with the multiplication rule.

eY , one might well wonder, why bother with K â†’ Y ,
Remark 6.8. Given the isomorphism AK â‰ƒ A
instead of just working with Y ? The advantage of K comes when we want to extend the family
eY â†’ Spec RY to (the correct) compact base, which turns out to be the toric variety associated
Proj A
to the secondary fan for K/K rather than for Y . One can already see this in the toric case: There
are maximal cones in the secondary fan of a polytope (reflexive in the Fano case) for each coherent
triangulation, which are dual complexes of a natural boundary, not on Y , but on the total space of
a line bundle (K in the Fano case). In the toric Fano case, we have Sec(K) â‰ƒ MoriFan(K) (which
is not the Mori fan for Y ).

24

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

6.2. Extension to the moving part of the secondary fan. We fix a sublattice N âŠ‚ Pic(K) â‰ƒ
Pic(K/K) â‰ƒ Pic(Y ) as in Assumption 2.7, with M the dual lattice. When applying to the proof of
Theorem 1.3 where Y is del Pezzo, we will simply take N = Pic(K) â‰ƒ Pic(Y ), then M â‰ƒ N1 (Y ). We
follow the notations in Remark 2.23.
e
Proposition 6.9. Let A âŠ‚ AT be the sub-Z-module with basis Î“(Z)
âŠ‚ Sk(T , Z), it is a Z[M]subalgebra. For any SQM K 99K KÎ± over K, we have an isomorphism of rings
âˆ¼

AKÎ± âŠ—RKÎ± Z[M] âˆ’âˆ’â†’ A,
e
where the image of AKÎ± is the sub-Z-module of A spanned by the basis elements Î¸P over all P âˆˆ Î“(Z)
e (cf. Theorem 3.5).
that are NE(KÎ± )M -above Ï•KÎ± : Î“ â†’ Î“
Proof. This follows from Theorem 3.5 and Proposition 6.1, using Remark 3.6.



Notation 6.10. For any cone Ïƒ âŠ‚ MovSec(K), we denote by PÏƒ âŠ‚ M the monoid of integer points
in the dual cone.
Proposition 6.11. Let Î± âŠ‚ MovFan(K) be a maximal cone, and Î³ := sec(Î±) the union of maximal
cones Î² with Ï•Î± = Ï•Î² (as in Theorem 2.12). Then the curve class of any structure disk for AKÎ±
lies in PÎ³ .
Proof. Let Î² âŠ‚ MovFan(K) be a maximal cone with Ï•Î± = Ï•Î² . Since KÎ± 99K KÎ² is an isomorphism
along V , the moduli spaces of structure disks for AKÎ± are naturally isomorphic to those for AKÎ² .
The only question is whether the classes of structure disks, computed in KÎ± or KÎ² , are the same.
This follows from Lemma 3.2, which implies that the class of a structure disk is determined by
Ï•Î± = Ï•Î² and the (punctured) structure disk in V . Consequently, the class of any structure disk for
AKÎ± lies in PÎ³ .

Corollary 6.12. The algebra AKÎ± is naturally a base extension of an RÎ³ := Z[PÎ³ ]-algebra, which
we denote by AÎ³ . We have a canonical inclusion AÎ³ âŠ‚ A, realizing it as the sub-Z-module with basis
e
the points of Î“(Z)
that are PÎ³ -above Ï•Î³ .
Proof. The first statement follows from Proposition 6.11, and the second from Proposition 6.9.



Lemma 6.13. For any two maximal cones Î±, Î² of MovSec(K), we have
AÎ± âŠ—Z[PÎ± ] Z[PÎ±âˆ©Î² ] = AÎ² âŠ—Z[PÎ² ] Z[PÎ±âˆ©Î² ] âŠ‚ A,
e
with basis the points of Î“(Z)
that are PÎ±âˆ©Î² -above Ï•Î± (or equivalently Ï•Î² ).
Proof. By Proposition 2.9(1), the difference Ï•Î² âˆ’ Ï•Î± : Sk(V ) â†’ MR has image in PÎ± . So the set of
e
points of Î“(Z)
that are PÎ±âˆ©Î² -above Ï•Î± is equal to the set of points that are PÎ±âˆ©Î² -above Ï•Î² . Now
we conclude from Corollary 6.12.

Denote MovSec := MovSec(K) for simplicity. We have
Spec Z[NE(K)M ] = TV(Nef(K), N) âŠ‚ TV(MovSec, N).
Now we can extend the family Spec AK â†’ Spec RK (resp. Proj AK â†’ Spec RK ) over the bigger
base TV(MovSec, N), by patching together all Spec AÎ³ (resp. Proj AÎ³ ) in the same way the open
affine subsets Spec Z[PÎ³ ] of TV(MovSec, N) are glued:
Proposition 6.14. Via Lemma 6.13, Spec AÎ³ (resp Proj AÎ³ ), for all maximal cones Î³ of MovSec,
glue to give a family Xb â†’ TV(MovSec, N) (resp. (X , O(1)) â†’ TV(MovSec, N)).

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

25

Next we describe the canonical theta functions on the family (X , O(1)) â†’ TV(MovSec, N). We
cannot expect each P âˆˆ Î“(Z) to give a global section of some O(n), otherwise the structure constants
would be global functions on the base and the family would be trivial. Instead, we need to twist
O(n) by the pullback of a toric line bundle LP on TV(MovSec, N) which we now describe.
Definition-Lemma 6.15. Let Î±, Î² âˆˆ MovSec be two maximal cones, and P âˆˆ Sk(V, Z). Let
P
:= Ï•Î± (P ) âˆ’ Ï•Î² (P ) âˆˆ M.
CÎ±,Î²
Ã—
P
Then CÎ±,Î²
âˆˆ PÎ±âˆ©Î²
, see Notation 6.10, where the superscript Ã— denotes the group of invertible
elements. Let UÎ± , UÎ² âŠ‚ TV(MovSec, N) denote the associated toric affine subvarieties. For fixed P ,
the collection of invertible functions
P

z CÎ±,Î² âˆˆ H 0 (VÎ± âˆ© VÎ² , OÃ— )
gives a ÄŒech 1-cocycle. We write LP for the associated toric line bundle on TV(MovSec, N).
Proof. By Proposition 2.9(2),
(Ï•Î± (P ) âˆ’ Ï•Î² (P )) Â· L = 0
P
Ã—
P
P
for all L âˆˆ Î± âˆ© Î², so we have CÎ±,Î²
âˆˆ PÎ±âˆ©Î²
. The cocycle condition for z CÎ±,Î² holds because CÎ±,Î²
is

defined by differences of sections.



Proposition 6.16. Given P âˆˆ Î“(Z), the theta functions Î¸Ï•Î± (P ) âˆˆ AÎ± over all maximal cones
Î± âˆˆ MovSec glue to a canonical section Î¸P of the pullback of LP to Xb, inducing a canonical section
of O(n) âŠ— Ï€ âˆ— (LP ) on X , with n := dtrop (P ) âˆˆ N and Ï€ : X â†’ TV(MovSec, N).
Proof. This follows from Proposition 6.14 and Definition-Lemma 6.15.



Definition 6.17. By Lemma 2.27, for P âˆˆ âˆ‚Î“(Z) or P = [Y ], the line bundle LP of DefinitionLemma 6.15 is trivial, thus the canonical section Î¸P of Proposition 6.16 gives a section Î¸P âˆˆ
H 0 (X , O(1)). In particular we have a canonical section for each P âˆˆP
Î›(Z) âŠ‚ Î“(Z), notation as in
Remark 2.23. We define Î˜ âŠ‚ X to be the zero scheme of the section P âˆˆÎ›(Z) Î¸P âˆˆ H 0 (X , O(1)).
The family X â†’ TV(MovSec, N) contains a natural boundary divisor E as follows:
For each maximal cone Î± âˆˆ MovSec, we denote by IÎ± âŠ‚ AÎ± the free RÎ± := Z[PÎ± ]-submodule with
basis the integer points Î“â—¦ (Z) in the interior of Î“.
Lemma 6.18. The RÎ± -submodule IÎ± âŠ‚ AÎ± is an ideal. The quotient AÎ± /IÎ± is a free RÎ± -module
with basis Î¸P , P âˆˆ âˆ‚Î“(Z). The multiplication rule on AÎ± /IÎ± is constant, more precisely, Î¸P Â· Î¸Q is
an integer combination of various Î¸R .
If (Y, D) satisfies [24, Assumption 2.4], then for P, Q âˆˆ âˆ‚Î“(Z), Î¸P Â· Î¸Q = Î¸P +Q if P, Q lie in a
common cone of âˆ‚Î“ (notation as in Remark 2.23), and Î¸P Â· Î¸Q = 0 otherwise.
Proof. To show that IÎ± is an ideal, it suffices to check that if Î¸R appears with non-zero coefficient
in the product Î¸P Â· Î¸Q , with Î´ trop (P ) > 0 and Î´ trop (Q) â‰¥ 0, then we have Î´ trop (R) > 0. This is
independent of Î±, so it is enough to check in AK . Then it follows from the nefness of âˆ’Î´ using [24,
Theorem 15.7(2)]. The second statement follows from the first.
To show that the multiplication rule on AÎ± /IÎ± is constant, by Proposition 6.9 and Lemma 2.27,
it suffices to prove it for K. It is equivalent to the statement that if Î¸R appears with non-zero
coefficient in the product Î¸P Â· Î¸Q with Î´ trop (P ) = Î´ trop (Q) = Î´ trop (R) = 0, then every contributing
structure disk has trivial curve class. This follows from Proposition 6.7 and the ampleness of âˆ’D,
using [24, Theorem 15.7(1)].

26

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Finally, under [24, Assumption 2.4], the explicit multiplication rule follows from [24, Theorem
15.7(3)].

Proposition 6.19. The Spec AÎ± /IÎ± over all maximal cone Î± âˆˆ MovSec glue to a subscheme E âŠ‚ X .
It is a trivial family over TV(MovSec, N), i.e. we have
(E, O(1)) â‰ƒ (X, O(1)) Ã— TV(MovSec, N),
for a polarized projective scheme X, moreover every theta function is pulled back from X.
If (Y, D) satisfies [24, Assumption 2.4], then (X, O(1)) is isomorphic to the polarized broken toric
variety given by the simplicial complex âˆ‚Î›, i.e. the Proj of the associated graded Stanley-Reisner
ring (see [32, Definition 1.6]).
Proof. This is immediate from Lemma 6.18.



Lemma 6.20. If Y has dimension two, then each fiber (X, O(1)) of the polarized constant boundary
family is a cycle of rational curves, with polarization of degree one on each irreducible component.
Moreover, the divisor Î˜ does not contain any nodes of X.
Proof. By Proposition 6.19, it suffices to compute the fiber over the unique 0-stratum of the base
TV(Nef(Y )). Then the result follows from Propositions 6.7 and 4.3.

6.3. The boundary torus action. Here we describe a natural torus action on the mirror family
X â†’ TV(MovSec, N) constructed in Proposition 6.14.
Recall N = n Pic(K) âŠ‚ Pic(K). Let ZÎ›(Z) be the free abelian group with basis the integer points
Î›(Z), notation as in (2.25), and ZÎ›(Z) it dual. Let L := nZÎ›(Z) âŠ‚ N, and Lâˆ— its dual. Let T Î› (resp.
TÎ› ) be the split torus with character (resp. cocharacter) lattice L.
Let w denote the composition
(6.21)

Î“(Z) â‰ƒ Î£(V âŠ‚K) (Z) âŠ‚ ZÎ›(Z) â†’ Lâˆ— .

We denote by the same letter w : M â†’ Lâˆ— , the dual of L â†’ N. For any SQM K 99K KÎ± over K,
by [24, Theorem 16.2], TÎ› acts diagonally on the mirror algebra AKÎ± with weight w(P ) + w(Î³) on
the basis vector z Î³ Î¸P . Now we check that the actions are compatible with respect to the gluing in
Proposition 6.14.
The points in Î›(Z) correspond to the irreducible components of the boundary divisor K \ V . As in
the proof of Lemma 2.13, they give rise to a function T â†’ T Î› , which tropicalizes to W : Sk(T ) â†’ Lâˆ—R ;
moreover, for each SQM K 99K KÎ± over K, the composition W â—¦ Ï•Î± : Î“(Z) â†’ Lâˆ— is equal to the
weight function w : Î“(Z) â†’ Lâˆ— in (6.21). Consequently, we obtain the following:
Proposition 6.22. The TÎ› -action on A induced by the isomorphism A â‰ƒ AKÎ± âŠ—RKÎ± Z[M] in
Proposition 6.9 is independent of the choice of SQM K 99K KÎ± over K; so we obtain an equivariant
action of TÎ› on the family X â†’ TV(MovSec, N).
6.4. Extension to the full secondary fan. In Section 6.2, we constructed the mirror family
(X , E, Î˜) over the toric variety associated to the moving part of the secondary fan MovSec(K). Next
we further extend this family to the toric variety associated to the full secondary fan Sec(K).
Recall from Lemma 2.26 that each bogus cone of Sec(K) is of the form Î³
b := Î³ + Râ‰¥0 [Y ] for a
cone Î³ of MovSec(K) lying in the boundary of the moving cone Mov(K).
Here is the basic idea for the extension over a bogus cone Î³
b. Assume for simplicity that N = Pic(K).
Let hÎ³iR âŠ‚ NR â‰ƒ Pic(K)R denote the span of Î³, and let hÎ³i (Z) := hÎ³iR âˆ© N. If hÎ³i (Z) and [Y ]

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

27

generate N, then the affine toric open subset of TV(Sec(K)) corresponding to the bogus cone is
isomorphic to
TV(Î³) Ã— TV(Râ‰¥0 [Y ]) â‰ƒ TV(Î³) Ã— A1 .
The structure torus of the A1 -factor is Th[Y ]i âŠ‚ TÎ› (notation as in Section 6.3). By the TÎ› equivariance, the mirror family restricted to TV(Î³) Ã— Gm is isomorphic to a product (XÎ³ , EÎ³ ) Ã— Gm .
Under the Th[Y ]i -action, Î¸[Y ] scales by Î» âˆˆ Gm â‰ƒ Th[Y ]i , while the other terms of Î˜ of Definition 6.17
remain constant. Hence we can extend the family over TV(Î³) Ã— {0} by the product (XÎ³ , EÎ³ ) Ã— {0},
with the Î¸[Y ] summand of Î˜ set to zero.
However, in general, hÎ³i (Z) and [Y ] generate only a finite-index sublattice of Pic(K), so the toric
open subset of TV(Sec(K)) corresponding to the bogus cone is not literally a product, and moreover
the base toric varieties are defined with respect to the sublattice N âŠ‚ Pic(K) instead of the whole
Picard group. To overcome these issues, we apply the general toric stack construction of Section 5,
specifically Corollary 5.7, with âˆ† = Sec(K), âˆ†0 = MovSec(K), N = N and L = hn[Y ]i âŠ‚ N (recall
N = n Pic(K) âŠ‚ Pic(K), and see Remark 5.4 regarding the choice of L). Hence we obtain the
extended mirror family (X , E, Î˜) over the toric stack T V(Sec(K), N). For the purpose of this paper,
i.e. the study of Conjecture 1.2, the stacky structure of T V(Sec(K), N) does not play any roles. So
for simplicity, in the absence of ambiguities, we will not distinguish T V(Sec(K), N) from its coarse
moduli space TV(Sec(K), N).
For use in the proof of Theorem 8.2, we describe more explicitly the extension above. For
any fan âˆ† in a lattice N and any cone Î³ âˆˆ âˆ†, we denote by S â—¦ (Î³, N ) âŠ‚ TV(âˆ†, N ) the open
stratum corresponding to Î³. Denote Sec := Sec(K) for simplicity. The open stratum of TV(Sec, N)
corresponding to the bogus cone Î³
b = Î³ + Râ‰¥0 [Y ] above is S â—¦ (b
Î³ , N). Pick a rational hyperplane
CR âŠ‚ Pic(K)R containing Î³, complementary to R[Y ], and denote C := CR âˆ© N. Then
g : S â—¦ (Î³, C) âˆ’â†’ S â—¦ (Î³, N) âˆ’â†’ TV(MovSec, N)
is an immersion, and S â—¦ (Î³, C) â†’ S â—¦ (b
Î³ , N) is a finite surjection. The composition S â—¦ (Î³, C) â†’
â—¦
Î³ , N) âŠ‚ TV(Sec, N) factors through T V(Sec, N) â†’ TV(Sec, N) giving quasi-finite h : S â—¦ (Î³, C)
S (b
â†’ T V(Sec, N), with image the stacky open stratum for Î³
b.
By the construction above, the h pullback of the extension (X , E, Î˜) to T V(Sec, N) is equal to
the g pullback of
(X , E, Î˜0 )|S â—¦ (Î³âˆˆâˆ†0 ,N)
where Î˜0 := Z( P âˆˆÎ›(Z)\[Y ] Î¸P ).
For example: when Î³ = 0 âˆˆ N, i.e. the corresponding divisorial contraction is just K â†’ K,
we have S â—¦ (Î³, N) â‰ƒ TN , S â—¦ (Î³, C) â‰ƒ TC âŠ‚ TN , and the finite surjection S â—¦ (Î³, C) â†’ S â—¦ (b
Î³ , N) is an
isomorphism. The extended family over the corresponding new open stratum S â—¦ (b
Î³ , N) is equal to
(X , E, Î˜0 )|TC , with Î˜0 obtained from Î˜ by setting the Î¸[Y ] -coefficient to zero.
P

6.5. An inductive structure on the mirror family. In this subsection, we assume Y is a
smooth del Pezzo surface. In the proof of Theorem 8.2, we will study the mirror family restricted
to different strata of TV(Sec(K)). We will show in Proposition 6.26 that over certain strata, the
restriction is isomorphic to the mirror family for some blowdown Y 0 of Y plus some simple constant
pieces. This gives an inductive structure on the mirror family, i.e. we will be able to reason by
induction on the Picard number.
We follow the notations of Lemma 2.28.

28

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Lemma 6.23. There is a regular divisorial contraction c : K 0 â†’ K 0 (over K), with exceptional
locus Y 0 âŠ‚ K 0 , contracting Y 0 to a point. Under the identification of Lemma 2.22(4), the cone
Nef(K 0 ) in MovFan(K) corresponds to the face hex(bY )i of Eff(Y ).
Proof. Consider the cone pâˆ— hex(bY )i in MovFan(K) under the identification of Lemma 2.22(4), and
the corresponding contraction K 99K K 0 , which is necessarily birational with exceptional locus
contained in Y âŠ‚ K, as we are working relatively over K. Since hex(bY )i is a face of the bogus
cone corresponding to cY : Y â†’ Y 0 , its pullback pâˆ— hex(bY )i is a face of bâˆ— (Nef(K 0 )); so it induces a
regular birational contraction c : K 0 â†’ K 0 , given by the linear system |mb(pâˆ— E)| for m  0, where
E := ex(bY ) and b(pâˆ— E) denotes the strict transform. By the description of b in Lemma 2.28, we
can compute b(pâˆ— E) explicitly, which is disjoint from Y 0 , so c contracts Y 0 to a point. Furthermore,
the flopped curves in K 0 are the only proper curves except those contained in Y 0 , and each meets
b(pâˆ— E) at exactly one point, so they are not contracted by c. It follows that Y 0 is the exception
locus of c.

Lemma 6.24. Let Î³ := Nef(K 0 ) âˆˆ MovFan(K). It is also a cone of MovSec(K). The corresponding closed stratum S(Î³) in TV(MoriFan(K)) (resp. in TV(Sec(K))) is canonically identified with
TV(MoriFan(KY 0 )) (resp. TV(Sec(KY 0 )).
Proof. Since the cone hex(bY )i is a face of Eff(Y ), by Lemma 6.23, Î³ is a face of Mov(K), hence
it is also a cone of MovSec(K). The second statement follows from the explicit description in
Proposition 2.29.

Lemma 6.25. Let Î± be a cone of MoriFan(K) that does not contain any Î³ as in Lemma 6.24
(for any SQM K 99K K 0 as in Lemma 2.28). Then Î± is either a cone in Nef(K) or a bogus cone
adjacent to Nef(K).
Proof. Under the isomorphisms of cones in Lemma 2.22(3), a cone Î³ as in Lemma 6.24 is either a
face of Eff(Y ) spanned by the exceptional divisors of a divisorial contraction, or a face of Nef(Y )
corresponding to fibrations. So the result follows.

Let Î“, Î“, Î› and Î› be as in Remark 2.23. The SQM b : K 99K K 0 over K induces a new
triangulation Î›0 of Î› by flopping the edges of Î› corresponding to the boundary components of ex(b).
By Lemma 2.28(4), the dual cone complex Î£(V âŠ‚KY 0 ) is a sub-complex of Î£(V âŠ‚K 0 ) . Let Î“Y 0 , Î“Y 0 ,
Î›Y 0 and Î›Y 0 denote the counterparts of Î“, Î“, Î› and Î› for Y 0 . Then Î›Y 0 is a sub-complex of Î›0 .
Let Î›Î³ be the coarsening of Î›0 where we remove all the edges internal to Î›Y 0 , thus Î›Î³ consists of
the polytope Î›Y 0 together with one triangle for each boundary component of ex(b). Let Î£Î³ := C(Î›Î³ ),
the cone complex over Î›Î³ , which has support Î“, and is a coarsening of Î£(V âŠ‚K 0 ) .
Proposition 6.26. Consider the restriction
(X , E)|S(Î³) â†’ S(Î³)
together with the canonical theta functions. The following hold:
(1) The product Î¸P Â· Î¸Q = 0 unless P, Q lie in a same maximal cone Ï„ of Î£Î³ . If Ï„ is not the
maximal cone Î“Y 0 âŠ‚ Î£Î³ , then Î¸P Â· Î¸Q = Î¸P +Q .
(2) Let X 0 âŠ‚ X be defined by the vanishing of Î¸P for all P âˆˆ Î£Î³ \ Î“Y 0 . Let E 0 âŠ‚ X 0 be defined
by the vanishing of Î¸P for all P âˆˆ Î“â—¦Y 0 âŠ‚ Î£Î³ . Then
(X 0 , E 0 ) â†’ S(Î³)

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

29

together with the restriction of the theta functions Î¸P , P âˆˆ Î“Y 0 , is canonically identified
with the mirror family (X , E)(Y 0 ,D0 ) for the pair (Y 0 , D0 := Y 0 \ U ) over TV(MoriFan(KY 0 ))
(resp. TV(Sec(KY 0 )) as in Lemma 6.24) with its theta functions.
Proof. It suffices to study the restriction to the open stratum S â—¦ (Î³) âŠ‚ S(Î³), the extension to the
closed stratum S(Î³) then follows by tracing through the extensions of Sections 6.2 and 6.4. Indeed,
the extension over the moving cone only concerns curve classes, which are read off from Ï•, while the
extension over the bogus cones is determined by the boundary torus action.
Let IS âŠ‚ RK 0 = Z[NE(K 0 )] be the ideal generated by (monomials associated to) curves not
contained in Y 0 âŠ‚ K 0 , i.e. not contracted by K 0 â†’ K 0 . Let f be a structure disk in a general
position contributing to the multiplication rule of AK 0 modulo IS . By Lemma 6.6, we can assume
that the cycle associated to f is supported on K 0 , then it is just supported on Y 0 , so the spine Sp(f )
(minus the marked points) lies in a same maximal cone of Î£Î³ (see [24, Lemma 7.2]). This implies
that Î¸P Â· Î¸Q = 0 modulo IS unless P, Q lie in a same maximal cone Ï„ of Î£Î³ . If Ï„ is not Î“Y 0 âŠ‚ Î£Î³ ,
then the fact that the cycle associated to f is supported on Y 0 implies moreover that the whole
tropical curve Trop(f ) (minus the marked points) lies in the interior of Ï„ . So the structure disk lies
in a toric locus, and we deduce from [24, Lemma 9.4] that Î¸P Â· Î¸Q = Î¸P +Q modulo IS . This shows
the first statement.
It follows that the RK 0 -submodule of AK 0 with basis Î¸P , P âˆˆ Î“Y 0 (Z) gives a subalgebra modulo
IS . So we see that the coordinate rings for X 0 |S â—¦ (Î³) â†’ S â—¦ (Î³) and X(Y 0 ,D0 ) |TPic(Y 0 ) â†’ TPic(Y 0 ) âŠ‚
TV(Nef(Y 0 )) have the same theta function basis, thus it remains to check that the multiplication
rules are the same. We show that the structure disks responsible for the structure constants in the
two cases are exactly the same. Let J âŠ‚ K 0 be as in Lemma 2.28(4), we have KY 0 â‰ƒ K 0 \ J. Note
J is disjoint from Y 0 , and is a disjoint union of irreducible components, one for each exceptional
curve of Y â†’ Y 0 . Write J = Jbdry âˆª Jint , according to whether the associated exceptional curve is
boundary or interior (see Proposition 2.29). Note Jbdry is a union of components of V âŠ‚ K 0 , while
Jint contains no boundary strata. Let f be the structure disk as above, with Sp(f ) lying in the
cone Î“Y 0 âŠ‚ Î£Î³ . Since J is disjoint from Y 0 , Jint has zero intersection with the class of f . It follows
by [24, Proposition 7.5] that the image of f is disjoint from Jint , so the structure disk (minus the
marked points) lies in KY 0 , and is thus a structure disk for the mirror algebra AKY 0 of KY 0 . This
identifies the structure disks in the two cases, completing the proof.

7. Singularities of the mirror family
In this section, all the varieties are assumed to be over C. We will prove a general proposition
concerning semi-log-canonical singularities in dimension two, see Proposition 7.2, and deduce that
in the 2-dimensional case, every fiber of the mirror family over the structure torus is a del Pezzo
surface with at worst du Val singularities, see Proposition 7.4.
Let AK be the graded mirror algebra over RK as in Proposition 6.7. We have Spec(RK âŠ— C) â‰ƒ
TV(Nef(Y )), the toric variety (over C) associated to the nef cone of Y . Let X := Proj(AK âŠ— C),
E âŠ‚ X the closed subscheme given by the ideal I âŠ‚ AK âŠ— C which has basis (as submodule) the
integer points Î“â—¦ (Z) in the interior of Î“, and Î˜ âŠ‚ X the divisor as in Definition 6.17.
Proposition 7.1. Let (X, E, Î˜) be a closed fiber of the mirror family (X , E, Î˜) â†’ TV(Nef(Y )).
The following hold:
(1) KX + E is semi-log-canonical and trivial (in particular Cartier).
(2) E âŠ‚ X is reduced and ample, and it is the zero locus of the theta function Î¸[Y ] , where
[Y ] âˆˆ Î› is the unique interior lattice point.

30

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

(3) X is Gorenstein, KX â‰ƒ O(âˆ’1) is anti-ample.
(4) The self-intersection number (âˆ’KX )dim X is equal to the number of 0-strata of D âŠ‚ Y .
(5) For the generic fiber, X is normal, (X, E) is log-canonical, and (X, E + Î˜) is stable for
sufficiently small  > 0.
Proof. Statements (1) and (5) follow from Proposition 6.7 and [24, Proposition 19.1]. For (2), under
the isomorphism of Proposition 6.7, Î¸[Y ] corresponds to T , and the ideal I âŠ‚ AK âŠ— C corresponds
to the ideal generated by T . Thus I is generated by Î¸[Y ] , which is a section of O(1), so (2) holds.
Then (1) and (2) implies (3). By (1) and (3), the self-intersection number (âˆ’KX )dim X is the degree
of O(1)|E , which by Proposition 6.19 is the number of maximal cones in âˆ‚Î›, which is the number of
0-strata of D, hence (4) holds.

We have a stronger result when Y is two-dimensional. We begin with the following general
proposition concerning semi-log-canonical singularities in dimension two.
Proposition 7.2. Let X be a connected surface and E âŠ‚ X an effective Cartier divisor which
e â†’ X be the
is a non-empty cycle of rational curves, such that KX + E is trivial and slc. Let X
g
e
e
normalization, NN âŠ‚ X the non-normal locus, and NN , E âŠ‚ X the reduced inverse images of NN , E.
e of the set of minimal log-canonical centers
Then X is canonical off NN , and the inverse image on X
g
e
for (X, E) is exactly the singularities of NN âˆª E.
For the proof we make use of the classification of log-canonical singularities in dimension two,
taken from [29, Theorem 4.15] and [25, Proposition 4.27].
Proposition 7.3. Let (Y, D) be a 2-dimensional log-canonical pair, with D reduced. Then D is a
curve with at worst ordinary nodal singularities, and locally analytically at every point p âˆˆ D âŠ‚ Y
we have one of the following:
(1) (0 âˆˆ A2x,y / 1r (1, a), (xy = 0)) (see [27, 3.19] for the notation for cyclic quotient singularity),
(2) (0 âˆˆ A2x,y / 1r (1, a), (x = 0)).
(3) Quotient of (1) by a Z/2Z-action which is free on Y \ p and interchanges the components of
D.
The divisor KY + D is Cartier only in case (1) and in the smooth case r = 1 of (2). Case (2) is
purely log-terminal. Cases (1) and (3) are strictly log-canonical (i.e. p is a log-canonical center).
g |S and F := E|
e be an irreducible component, B := NN
e S . Since
Proof of Proposition 7.2. Let S âŠ‚ X
(X, E) is slc, (S, B + F ) is log-canonical. In particular, B + F is a nodal curve by Proposition 7.3.
Since KS + B + F = 0, by adjunction each connected component of B + F is a either a smooth
elliptic curve or a cycle of rational curves. By Proposition 7.3, the 0-dimensional log-canonical
centers of (S, B + F ) on B + F are the nodes of B + F .
We let d : (Y, D) â†’ (S, B + F ) be a dlt model, and use [28, Prop. 5.1]. We have KY + D =
dâˆ— (KS + B + F ). Since (S, B + F ) is log-canonical, we have ZY = dâˆ’1 (ZS ) where Z in each case
indicates the non klt locus of the pair. By [28, Prop. 5.1], either ZY and ZS are both connected
(connectedness of one is equivalent to connectedness of the other since d has connected fibers) or we
are in case (2) of loc. cit..
Let us first suppose that ZS is connected. The surface X is connected by assumption, and has
normal crossing singularities in codimension 1 and satisfies Serreâ€™s condition S2 by the definition of
slc singularities (see e.g. [27, Definition-Lemma 5.10]). The S2 condition implies that the intersection
of S with the union of the other irreducible components of X has pure codimension 1 (see [19,

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

31

Theorem 5.10.7]). So if X is reducible then F =
6 0 (and if X is irreducible then B 6= 0 by assumption).
So B + F 6= 0. Now since ZS contains B + F and S has isolated singularities, ZS = B + F (and so
B + F is connected) and S is klt away from B + F . Also, S is Gorenstein away from B, because X
is Gorenstein, so S is canonical away from B + F . Now by adjunction B + F is either a smooth
(connected) elliptic curve, or a cycle of smooth rational curves. In the smooth elliptic curve case,
if B is not empty (equivalently, if X is not normal), F is empty and thus S is disjoint from the
preimage of E.
Next we consider case (2) of [28, Prop. 5.1]: (Y, D) is purely log-terminal, and D has two
connected components. Then by Proposition 7.3, D is smooth, Y is smooth near D, ZY = D, and
by adjunction D is a disjoint union of two elliptic curves. Set-theoretically D = dâˆ’1 (B + F ). It
follows that B + F is a disjoint union of two irreducible curves each with elliptic normalization. But
any irreducible component of F is rational, so F = 0 and S is disjoint from the preimage of E.
But now note that if we have two adjacent S1 , S2 (i.e. the intersection of their images in X
contains a curve), then one satisfies case (2) of [28, Prop. 5.1] if and only if the other does (because
they then share an elliptic double curve). Now by the connectedness of X, if one S satisfies case (2)
e do. But then by the above, E is empty, a contradiction.
of [28, Prop. 5.1], all components of X
We conclude that we are in the B + F connected case above, with B + F a cycle of rational curves,
e By Proposition 7.3, the minimal log-canonical centers of
for each irreducible component S âŠ‚ X.
e of the log-canonical centers
(S, B + F ) are exactly the nodes of B + F . But the inverse image on X
of (X, E) is just the union of the centers of (S, B + F ), thus the inverse image of the minimal
g âˆª E.
e We argued above that S is canonical
log-canonical centers of (X, E) is exactly the nodes of NN
away from B + F , thus X is canonical away from NN âˆª E. For an exceptional divisor W with center
in E \ NN , the discrepancies satisfy a(W, X) â‰¥ a(W, X, E) + 1 (notation as in [27, Definition 2.4]),
since E is Cartier. Therefore, since KX + E is log-canonical off NN , X is canonical along E \ NN ,
and thus canonical off NN . This completes the proof.

Proposition 7.4. In the context of Proposition 7.1, assume Y is 2-dimensional, i.e. a del Pezzo
surface. Then for every fiber (X, E) of the mirror family over the structure torus TPic(Y ) âŠ‚
TV(Nef(Y )), X is a del Pezzo surface with at worst du Val singularities, E âŠ‚ X is an anti-canonical
cycle of KX -degree-(âˆ’1) rational curves, and the self-intersection number of âˆ’KX is equal to the
number of irreducible components of D.
Proof. By Proposition 7.1, the self-intersection number of âˆ’KX is equal to the number of irreducible
components of D. Then it follows from Proposition 6.19 that E âŠ‚ X is an anti-canonical cycle of
KX -degree-(âˆ’1) rational curves. It remains to show that X is du Val (which in dimension two is
the same as canonical). Consider the equivariant boundary torus TD -action on the mirror family
X â†’ TV(Nef(Y )) (see [24, Â§16]). Since D is ample, by [9, Â§2.3], there is a one-parameter subgroup
Gm âŠ‚ TD that pushes any point of TV(Nef(Y )) to the unique toric 0-stratum 0 âˆˆ TV(Nef(Y )).
Given t âˆˆ TPic(Y ) , taking closure of the orbit Gm Â· t, we obtain Gm âŠ‚ A1 â†’ TV(Nef(Y )). Consider
the pullback family Ï€ : (X , E)|A1 â†’ A1 . By the equivariant torus action, Ï€ is a trivial family over
Gm . By Proposition 7.2, in order to prove that Xt is canonical, it suffices to show that its singular
locus has codimension at least two. Suppose to the contrary that its singular locus has codimension
one, and consider the closure of the singular locus of Ï€|Gm . Then its intersection with the central
fiber has codimension at most 1. The central fiber (of X \ E) is isomorphic to the cone over an
n-cycle of rational curves (see Proposition 4.3), which looks like an umbrella, with singular locus
the ribs of the umbrella. Thus by generic smoothness, the total space X |A1 is non-normal at the
generic point of some rib. Using Proposition 4.10, this contradicts the local equations for the mirror

32

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

family along (the interior of) a rib, see [13, Eq. (2.7)]: In fact, if we base change to the completion
of RY âŠ— C at the maximal monomial ideal m, then because fÏi = 1 mod m (notation from [13, Eq.
(2.7)]), a neighborhood in X of (the interior of) the rib is isomorphic to the toric Mumford family,
with explicit equations [13, Eq. (0.5)], which is clearly normal.

8. Modularity of the mirror family
Let Y be a smooth complex del Pezzo surface, and D âŠ‚ Y a normal crossing anti-canonical
divisor containing a 0-stratum. Let (X , E, Î˜) be the mirror family over the toric variety TV(Sec)
associated to the full secondary fan which we constructed in Section 6.4.
Notation 8.1. In this section, we will always consider mirror families after base change to C, so
we will omit the base change from the notation, in particular, TV(Â·) will now denote toric varieties
over C (contrary to Notation 5.1).
The goal of this section is to prove the following:
Theorem 8.2. The following hold:
(1) The mirror family (X , E) â†’ TV(Sec) is a flat family of semi-log-canonical pairs (X, E) with
KX + E trivial (in particular Cartier), and H i (X, O) = 0 for i > 0.
(2) The boundary E â†’ TV(Sec) is a trivial family, with fiber a cycle of rational curves.
(3) For every fiber (X, E) over the structure torus TPic(Y ) âŠ‚ TV(Sec), X is a del Pezzo surface
with at worst du Val singularities, E âŠ‚ X is an anti-canonical cycle of KX -degree-(âˆ’1)
rational curves, and the self-intersection number of KX is equal to the number of irreducible
components of D.
(4) For 0 <   1, (X , E + Î˜) â†’ TV(Sec) is a family of stable pairs.
(5) The induced map TV(Sec) â†’ SP to the moduli space of stable pairs is finite.
From Theorem 8.2 we deduce the next theorem, which is a detailed version of Theorem 1.3.
Theorem 8.3. Let Y be a smooth complex del Pezzo surface and D âŠ‚ Y an anti-canonical cycle of
(âˆ’1)-curves. Then the generic fiber of the mirror family over TV(Sec) is smooth, and one fiber is
the original (Y, D). The image of the finite map TV(Sec) â†’ SP in Theorem 8.2(5) is equal to the
closure Q âŠ‚ SP, where Q is the moduli space in Conjecture 1.1 for the pair (Y, D).
Proof. Suppose D has n irreducible components, then n is also the degree of Y , and thus Pic(Y )
has rank 10 âˆ’ n. Therefore by the dimension count in Proposition 8.4, the image of the finite map
TV(Sec) â†’ SP is equal to the closure Q âŠ‚ SP. In particular, the generic fiber of the mirror family
must be smooth, and one fiber is the original (Y, D).

Proposition 8.4. For n = 1, . . . , 9, let Qn (resp. QdV
n ) be the moduli space of triples (X, E, Î˜)
where X is a smooth (resp. du Val) del Pezzo surface of degree3 n, (X, E) is a log-canonical pair,
E âˆˆ |âˆ’KX | is a cycle of KX -degree-(âˆ’1) curves, and Î˜ âˆˆ |âˆ’KX | does not pass through any singular
point of E. Then Qn is empty unless n â‰¤ 6; in this case it is irreducible of dimension at most
10 âˆ’ n. On the other hand, QdV
n has dimension at most 9 âˆ’ n, (and is possibly reducible).
Proof. Let us first consider the smooth case Qn : To see that Qn is empty for n â‰¥ 7, suppose to the
contrary that D = D1 + . . . Dn with n â‰¥ 7. Let a := D1 + D2 + D3 and b := D5 + D6 . Then a2 > 0,
b2 = 0 and a Â· b = 0, which contradicts the Hodge index theorem. For n â‰¤ 5 the result follows from
3By degree we mean the self-intersection number of K .
X

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

33

[30, Theorem 1.1], which gives a concrete description of all pairs (X, E). If n = 6, then (X, E) is
toric and unique (see [12, Lemma 1.3]) and the result is obvious. Next we estimate the dimension of
e
QdV
n . Let p : X â†’ X be a minimal resolution, which is crepant by the du Val assumption. Note
âˆ—
2
e
that âˆ’KX
e = p (âˆ’KX ) is nef and big, but not ample. So X is a blowup of P at 9 âˆ’ n (possibly
infinitely near) points, which are not in general position (otherwise âˆ’KX
e is ample), i.e. they satisfy
the divisorial conditions as in the first paragraph of [33, Appendix A]. We can fix 4 of the points by
automorphisms of P2 , thus the number of moduli for the points on P2 is at most 2 Â· (5 âˆ’ n) âˆ’ 1. The
linear system |âˆ’KX
e | = |âˆ’KX | has dimension n. Each irreducible component of the strict transform
e of E is one of the finitely many (âˆ’1)-curves on X,
e so this adds no moduli. Therefore, QdV
E
n has
dimension at most 9 âˆ’ n, completing the proof.

Remark 8.5. Given (Y, D = D1 + . . . Dn ) as in the context of Theorem 8.2, let di := âˆ’KX Â· Di .
Modify slightly the above definition of QdV
n adding the conditions that E = E1 + . . . En (where
we cyclically order the components Ei and Di ) and that X has an Adi âˆ’1 singularity at the node
Ei âˆ© Ei+1 . Then by a more involved dimension count and some finer analysis of the mirror family,
we can prove that the image of the finite map TV(Sec) â†’ SP of Theorem 8.2(5) is the closure of
QdV
n in SP.
8.1. Proof of the main theorem. Now we turn to the proof of Theorem 8.2.
Since the extension of the mirror family over the bogus cones are done via the equivariant
boundary torus action (see Section 6.4), it suffices to prove (1) for the restriction to the moving part
of the secondary fan. That reduces to the study of singularities of the mirror family associated to
every SQM K 99K KÎ± , which follows from [24, Proposition 19.1].
Statements (2) and (3) follow from Propositions 6.19 and 7.4 respectively.
Next we prove (4). By (1) it is enough to check that for every fiber (X, E, Î˜), Î˜ is disjoint from any
minimal (under inclusion) log-canonical centers of (X, E), which are described by Proposition 7.2,
in particular they are all 0-dimensional. Moreover by Lemma 6.20, we only need to consider
0-dimensional log-canonical centers of X \ E.
Since the secondary fan is a coarsening of the Mori fan, each cone Î³0 âˆˆ Sec(K) contains a
(not necessarily unique) cone Î³ âˆˆ MoriFan(K) of the same dimension. Let S â—¦ (Î³) âŠ‚ S(Î³) âŠ‚
TV(MoriFan(K)) denote the associated open and closed strata. Then it suffices to prove (4) for
the restriction of the mirror family over all such strata S â—¦ (Î³). If Î³ is of the form in Lemma 6.24,
let X 0 âŠ‚ X be as in Proposition 6.26 and X 0 := X âˆ© X 0 . For log-canonical centers contained in
X \ X 0 , the statement follows from Proposition 6.26(1) because the irreducible components of this
closure are toric projective varieties, and the theta functions restrict to toric monomials. Then
by Proposition 6.26(2), we can proceed by induction on the Picard number of Y . The cones of
MoriFan(K) that do not contain any Î³ as in Lemma 6.24 are described in Lemma 6.25. Therefore,
it remains to consider the restriction of the mirror family over every open stratum S â—¦ (Î³) where Î³ is
câˆ— Nef(K 0 ) for a regular contraction c : K â†’ K 0 , or the associated bogus cone câˆ— Nef(K 0 ) + Zâ‰¥0 [Y ].
We refer to these two cases as the nef cone case and the bogus cone case. We will enumerate the
possibilities for c : K â†’ K 0 , which will also be used later in the proof of (5). Let f : Y â†’ Y 0 denote
the contraction induced by c : K â†’ K 0 .
Consider a fiber (X, E, Î˜) over the open stratum S â—¦ (Î³) as above, and a 0-dimensional log-canonical
center z of (X, E) in X \ E. In order to show that Î˜ does not contain z, it is enough to establish
the following:
Claim 8.6. Exactly one of the theta functions Î¸P , P âˆˆ Î›(Z) is non-vanishing at z.

34

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

Let us prove Claim 8.6. Let V â†’ TV(Nef(Y )) â‰ƒ Spec RY denote the restriction of X \ E to
TV(Nef(Y )). Recall from Proposition 6.7 that V â‰ƒ Spec(AY ).
Case I: the nef cone case where Y 0 is a point. Then the open stratum S â—¦ (Î³) is the structure
torus TPic(Y ) âŠ‚ TV(Nef(Y )). By Proposition 7.4, there are no log-canonical center z of (X, E) in
X \ E. So this case does not occur.
Case II: the nef cone case where f : Y â†’ Y 0 is birational, i.e. c : K â†’ K 0 is small. By the choice
of Î³, it is contained in a cone Î³0 âˆˆ Sec(K) of the same dimension. We claim that the exceptional
locus of f is a disjoint union of boundary (âˆ’1)-curves. Indeed, factor f through f1 : Y â†’ Y1 which
contracts exactly the boundary exceptional divisors of f , and let Î³1 := f1âˆ— (Nef(Y1 )). Then by
Remark 2.30, the set of cones of Sec(K) containing Î³ is the same as the set of those containing
Î³1 . The intersection of those cones is Î³0 . Since Î³ and Î³0 have the same dimension, we deduce that
Î³ = Î³1 and f = f1 .
The ideal J âŠ‚ Z[NE(Y, Z)] associated to the closed stratum S(Î³) is the monomial ideal generated
by all curves other than the f : Y â†’ Y 0 exceptional curves. Since the exceptional locus is contained
in D, and any effective cycle supported on the exceptional locus is rigid in the sense of Definition 4.8,
it follows from Corollary 4.9 that the restriction of V to S(Î³) is the purely toric Mumford partial
smoothing of VÎ£(Y,D) to VÎ£(Y 0 ,D0 ) (see [12, Â§1.2]). Then Claim 8.6 holds because z must be the center
of the umbrella, and Î¸0 is the only theta function that does not vanish there.
Case III: the nef cone case where f is a ruling Y â†’ P1 . We will show that over S â—¦ (Î³) there are
no log-canonical center z of (X, E) in X \ E. So this case does not occur.
Again, the ideal J âŠ‚ Z[NE(Y, Z)] associated to the closed stratum S(Î³) is generated by all curves
not contained in a fiber of f . Decompose D = DH + DF , where DF are the irreducible components
contracted by f , and DH are the horizontal components. Let Î£H be the coarsening of Î£(Y,D)
retaining only the rays corresponding to the horizontal components.
We factor f through f1 : Y â†’ Y1 contracting (âˆ’1)-curves in fibers of f which meet DH \ DF .
Note that the tropicalization of any structure disk (that contributes modulo J) cannot cross rays of
Î£H , otherwise the disk class will contain a component of DH and so be trivial modulo J. It follows
that such structure disks are disjoint from f1 -exceptional divisors, so the mirror family over S â—¦ (Î³) is
obtained by base extension from the analogous family for Y1 . Therefore, replacing Y by Y1 , we can
assume there are no such (âˆ’1)-curves.
Now we refer to Section 8.2 to finish the proof of case III. If DH is irreducible, we can invoke
Proposition 8.12 to deduce the absence of 0-dimensional log-canonical centers. If DH is reducible,
note that Î¸P Â· Î¸Q = 0 mod J unless P, Q lie in a same cell of Î£H , and the family V restricted to
S â—¦ (Î³) is the union of two irreducible components, each given by the vanishing of all Î¸P with P lies
in a single cone of Î£H . Write X =: X1 âˆª X2 and F := X1 âˆ© X2 . Then each (Xi , F ) is of the form
(V 0 , C 0 ) in Proposition 8.12. By Proposition 7.2, any 0-dimension log-canonical center of X must be
a log-canonical center of (Xi , F ) for i = 1 or 2. So we can again conclude by Proposition 8.12.
Next we consider the bogus cone case. Then c : K â†’ K 0 is a divisorial contraction, so the
corresponding f : Y â†’ Y 0 is a fibration. We distinguish case IV where Y 0 is a point, and case V
where Y 0 â‰ƒ P1 . Recall from Section 6.4 that the fibers (X, E) over S â—¦ (Î³) are all isomorphic to fibers
over S â—¦ (câˆ— Nef(K 0 )). But by the analysis we just made in cases I and III, there are no 0-dimensional
log-canonical centers off E in fibers over S â—¦ (câˆ— Nef(K 0 )), so cases IV et V also do not occur. This
completes the proof of (4).
Now we turn to the proof of (5), the finiteness of the map TV(Sec) â†’ SP.

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

35

Lemma 8.7. Let X be a complete toric variety. A map f : X â†’ Y to any other variety is finite if
and only if no toric 1-stratum of X is contracted to a point.
Proof. The â€œonly ifâ€ direction is obvious. For the â€œifâ€ direction, assume there is an irreducible
curve C âŠ‚ X contracted by f , and we want to find a contracted toric 1-stratum. Choose a toric
e â†’ X with X
e projective, and C
eâŠ‚X
e an irreducible curve mapping onto C. Consider
resolution b : X
the closure
e âŠ‚ Hilb(X)
e
P := T Â· {C}
e where T âŠ‚ X
e is the structure torus. This closure is proper so
in the Hilbert scheme of curves in X,
contains a torus fixed point p (e.g. its normalization is a projective toric variety on which T has
a dense open orbit, just take the image of a torus fixed point on the normalization). Then the
e
corresponding curve is supported on a 1-stratum. Choose an irreducible curve S âŠ‚ P connecting {C}
and p, and let C â†’ S be the corresponding family. Consider g := f â—¦ b : C â†’ Y . By assumption the
e âŠ‚ C is contracted by g, so by the rigidity lemma ([29, Lemma 1.6]), every fiber is contracted,
fiber C
in particular, f (b(Cp )) is a point. Again by the rigidity lemma, b : C â†’ X does not contract any
fibers, in particular b(Cp ) has support a toric 1-stratum, completing the proof.

By Lemma 8.7, for the proof of Theorem 8.2(5), it suffices to show that no toric 1-stratum of
TV(Sec) is contracted (to a point). We will show more:
Claim 8.8. The restriction of the mirror family (X , E) to every toric 1-stratum S of TV(Sec) is
non-trivial. More precisely, we will exhibit a 0-stratum s âˆˆ âˆ‚S and a double curve in the fiber Vs
which disappears over S â—¦ , except in case III below it will be a 0-dimensional log-canonical center
which disappears.
So we no longer care about the boundary E and the divisor Î˜. As in the proof of (4), using
Proposition 6.26 and Lemma 6.25, by induction on the Picard number of Y , it is enough to consider
toric 1-strata of the form S(Î³) along the five cases as before.
Case I: the nef cone case where Y 0 is a point. Then the open stratum S â—¦ (Î³) is the structure
torus (and since we are assuming this is a 1-stratum, Y has Picard number one). The generic fiber
over S â—¦ (Î³) is normal by Proposition 7.1, while the fiber over the 0-stratum associated to Nef(K) is
the non-normal umbrella by Proposition 4.3. So Claim 8.8 holds in this case.
Case II: the nef cone case where f : Y â†’ Y 0 is birational. Since S(Î³) is 1-dimensional, Î³ âŠ‚
Pic(K)R has codimension 1, so f is the contraction of a single boundary (âˆ’1)-curve E âŠ‚ D âŠ‚ Y . The
fiber over the 0-stratum associated to Nef(K) is the umbrella, and the double curve corresponding
to the ray of Î£(Y,D) given by E smooths along S(Î³) by the toric Mumford smoothing. So Claim 8.8
holds in this case.
Case III: the nef cone case where f is a ruling Y â†’ P1 . Since Î³ âŠ‚ Pic(K)R has codimension one,
f : Y â†’ P1 is a smooth P1 -bundle, and Î³ âŠ‚ Nef(K) gives a 0-stratum in S(Î³), with fiber the umbrella
VÎ£(Y,D) , which has a 0-dimensional log-canonical center (i.e. 0 âˆˆ VÎ£(Y,D) ). By Proposition 8.12, the
fibers over S â—¦ (Î³) no longer have 0-dimensional log-canonical centers, completing the proof in this
case.
Case IV: the bogus cone case where Y 0 is a point. We have Î³ = 0 + Zâ‰¥0 [Y ]. Since Î³ has
codimension one, Y has Picard number two. There are two possibilities for the del Pezzo, in either
case there is a ruling r : Y â†’ P1 . By Section 6.4, the fibers of X over S â—¦ (Î³) occur as fibers over
S â—¦ (0) = TPic(K) , which are normal by Proposition 7.4. But the ruling determines a 0-stratum in
âˆ‚S(Î³), given by the cone Î³r := câˆ—r Nef(Kr ) + Zâ‰¥0 [Y ], where cr : K â†’ Kr is the divisorial contraction

36

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

with exceptional locus r : Y â†’ P1 . Again by Section 6.4, the fibers of X over S â—¦ (Î³r ) occurs as fibers
over S â—¦ (câˆ— Nef(Kr )). Recall from the analysis of case III in the proof of (4) that all fibers over
S â—¦ (câˆ— Nef(Kr )) are non-normal, completing the proof in this case.
Case V: the bogus cone case where Y 0 â‰ƒ P1 . We have Î³ = câˆ— Nef(K 0 ) + Zâ‰¥0 [Y ]. Since Î³ has
codimension one and Pic(K 0 /K) â‰ƒ Pic(P1 ) has rank 1, Pic(Y ) has rank 3; it follows that f : Y â†’ P1
has a unique singular fiber. We consider the restriction to the closed stratum (X , E) â†’ S(Î³) = P1 ,
and show that it is not constant. By Section 6.4 and case III in the proof of (4), the fibers over
the open stratum S â—¦ (Î³) are unions of two normal surfaces, meeting along a smooth P1 (except
when DH is irreducible, then the normalization is integral and the conductor is a smooth P1 ).
Let F = E1 + E2 âŠ‚ Y be the singular fiber of f . We can flop either Ei and obtain K 99K Ki ,
which induces Y â†’ Yi contracting Ei . There is a regular divisorial contraction ci : Ki â†’ Ki0 with
exceptional locus ri : Yi â†’ P1 , a smooth P1 -bundle, and then a regular contraction Ki0 â†’ K 0 , with
exceptional locus P1 , the flopped curve Ei0 âŠ‚ Ki . Then Î³ âŠ‚ Î³Ei := câˆ—i Nef(Ki0 ) + Zâ‰¥0 [Y ], where Î³Ei
are maximal cones and the corresponding 0-strata are the 0-strata in the closed 1-stratum S.
We claim that at least one of the Ei âŠ‚ Y is a boundary divisor (i.e. an irreducible component of
D âŠ‚ Y ). Otherwise, by Proposition 2.29 and Remark 2.30, the two cones câˆ—i Nef(Ki0 ) âˆˆ MovFan(K)
lie in the same cone of MovSec(K), then Î³ would not have the same dimension as the minimal cone
of MovSec(K) that contains it, a contradiction.
Without loss of generality say E1 âŠ‚ D, and we consider its flop. Let Î›1 be the dual complex of
the central fiber of K1 â†’ A1 , obtained from Î› by flopping the edge corresponding to E1 . The fiber
over the corresponding 0-stratum S(Î³E1 ) (which we recall from Section 6.4 is a fiber over a point
of S â—¦ (câˆ—1 Nef(K10 )) has a double curve corresponding to E10 (i.e. to the new edge of Î›1 ). From the
description of the fibers over the open stratum S â—¦ (Î³) above, this double curve is smoothed over
S â—¦ (Î³), since E10 is contracted under K10 â†’ K1 .
This completes the proof of Claim 8.8 and thus of Theorem 8.2.
8.2. The mirror family for P1 -fibrations. Here is a detailed analysis for the case III in the proof
of Theorem 8.2. We use the comparison Proposition 4.10 to borrow results from [12, Â§6].
Let (Y, D) be a Looijenga pair with a fibration f : Y â†’ P1 with generic fiber P1 . Assume that f
is smooth over A1 \ 0.
Notation 8.9. For the rest of this subsection, we replace (Y, D) and f by their restrictions to
A1 âŠ‚ P1 . Write D = DH + DF , where DF consists of irreducible components contained in fibers,
and DH consists of horizontal components (which is either a union of two sections, or an irreducible
component necessarily of degree 2 over the base). We assume that DF lies over 0 âˆˆ A1 . Note that D
is a cycle of rational curves if DH is irreducible; but if DH is reducible, then D is a chain of rational
curves, with two non-proper ends, the components of DH .
Since [12, Â§6] does not treat the case of irreducible DH , we have to do a bit of analysis in this
case.
Let B be the support of the dual cone complex Î£(Y,D) , with a canonical Z-affine structure
determined by the self-intersection numbers of the irreducible components of DF . If DH is irreducible,
let B 0 be obtained from B by cutting along the ray of Î£(Y,D) corresponding to DH . Let q : B 0 â†’ B
be the quotient map identifying the two boundary rays of B 0 . When DH is reducible we take
B 0 := B. Note that B 0 is isomorphic (as Z-affine manifold with boundary) to a convex cone in R2 ,
which is a half space if and only if the map f : Y â†’ A1 is toric.
Let R := C[NE(Y /A1 )], S := Spec(R), A the free R-module with basis B(Z), and A0 the free
R-module with basis B 0 (Z). The construction of [12, Â§6] gives an R-algebra structure on A0 using

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

37

the formalism of scattering diagram and broken lines (this construction depends only on the formal
neighborhood of the fiber DF , so it makes sense also in the case where DH is irreducible). The
scattering diagram is finite (there are only finitely many rays, and the attached functions are
polynomials, as opposed to formal power series), and does not contain either of the boundary rays
of B 0 , so it can be equivalently viewed as a scattering diagram on B. Then the exact same structure
constants (using broken lines) gives an R-algebra structure on A. Let I âŠ‚ A be the free R-submodule
with basis Î¸b for b âˆˆ B(Z) not on a ray associated to any component of DH .
Proposition 8.10. Let A â†’ A0 be the map of R-modules sending
X
Î¸b 7â†’
Î¸b0 .
b0 âˆˆq âˆ’1 (b)

This is an inclusion of R-algebras, and is an integral extension. The submodule I is an ideal of both
A and A0 . For any Î¸b âˆˆ I, we have an isomorphism of the localizations AÎ¸b â‰ƒ A0Î¸b .
Proof. The proposition is easy to check if Y â†’ A1 is toric, so we may assume that B 0 is strictly
convex. The multiplication rules given by the scattering diagrams imply that A â†’ A0 is an inclusion
of R-algebras. Moreover, the strict convexity of B 0 implies:
Claim 8.11. For a, b âˆˆ B 0 (Z), if r âˆˆ B 0 (Z) \ 0 lies on a boundary ray, and Î¸r has nonzero coefficient
in the product Î¸a Â· Î¸b , then a, b must lie on the same boundary ray as r. In particular, Î¸a Â· Î¸b âˆˆ A âŠ‚ A0
unless a, b lie on a same boundary ray.
Now take b âˆˆ B(Z) lying on (the image of) a boundary ray, and write q âˆ’1 (b) = b1 + b2 . Since
Î¸b = Î¸b1 + Î¸b2 , we have
Î¸b1 Â· Î¸b = Î¸b21 + Î¸b1 Â· Î¸b2 .
The claim implies that Î¸b1 Â· Î¸b2 âˆˆ A âŠ‚ A0 . It follows that Î¸b1 âˆˆ A0 is integral over A, and thus
A âŠ‚ A0 is an integral extension. The claim also implies that I is an ideal of both A and A0 , and
gives the localization statement. This completes the proof.

Let V 0 := Spec(A0 ) and V := Spec(A). Let C 0 âŠ‚ V 0 , C âŠ‚ V be the subschemes given by the ideal
I. Note C 0 = q âˆ’1 (C), and q : V 0 â†’ V is an isomorphism outside C.
Proposition 8.12. For any fibers (V 0 , C 0 ), (V, C) over the open stratum (i.e. the structure torus)
S â—¦ âŠ‚ S, V 0 is normal, V 0 \ C 0 â‰ƒ V \ C are canonical, and the pairs (V, C), (V 0 , C 0 ) have no
0-dimensional log-canonical centers.
Proof. Consider first the statement for (V 0 , C 0 ). For this we can assume DH is reducible, as
A0 depends only on the formal neighborhood of the fiber DF . If DF is a full fiber of f then
f : (Y, D) â†’ A1 is toric, V 0 â†’ S is also toric, and the computation is easy. If DF is not the full fiber,
then DF has negative-definite intersection matrix, and f factors through Y â†’ Y 0 contracting DF
to a point. The open stratum S â—¦ â‰ƒ TPic(Y /A1 ) is covered by translates of TPic(Y 0 /A1 ) âŠ‚ TPic(Y /A1 ) ,
and the restriction of (V 0 , C 0 ) to such cosets is described explicitly as a hypersurface, in the first
displayed formula on [12, p. 136]. From this the proposition for (V 0 , C 0 ) follows, and implies the
statement for (V, C), since by Proposition 8.10, q : V 0 â†’ V is the normalization, and V â‰ƒ V 0 / âˆ¼,
where âˆ¼ is the involution of the smooth curve C 0 interchanging the theta functions Î¸b1 , Î¸b2 as in the
proof of Proposition 8.10.


38

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

8.3. Speculative strategy for the general conjecture. Here we sketch briefly how we expect
the general Conjecture 1.2 can be proven, by running the mirror machine twice to obtain the desired
universal family.
Let (Y, D, H) be an element in the moduli space Q of Conjecture 1.1. Let RY := C[NE(Y, Z)],
bY the completion along m. Intersecting with H gives
m âŠ‚ RY the maximal monomial ideal and R
RY  C[N] =: RH

bY  R
bH .
and R

bY -module with basis Sk(U, Z) where U := Y \ D.
Let AY be the free R
bY -algebra structure on AY . We denote the restricConjecture 8.13. There is a canonical formal R
bH by X. It has trivial canonical bundle and has canonical singularities. Let
tion of Spf AY to Spf R
b â†’ X be a crepant terminal resolution, X
bH , Rq := C[NE(X/X,
b0 the central fiber over Spf R
b
q: X
Z)]
and Aq the free Rq -module with basis the integer points in the cone Î“ over the dual complex Î› of
b0 . Then there is a canonical graded Rq -algebra structure on Aq , and we denote Y := Proj Aq .
X
Let D âŠ‚ Y be the zero locus of the ideal generated by the integer points in the interior of Î“, and
Î˜ âŠ‚ Y the zero locus of the sum of basis elements corresponding to the integer points in Î›. The
family (Y, D, Î˜) over TV(Nef(q)) â‰ƒ Spec Rq extends canonically to a family over a complete toric
variety TV(Sec(q)), where Sec(q) generalizes the construction of the secondary fan in Section 2.
For 0 <   1, (Y, D + Î˜) â†’ TV(Sec(q)) is a family of stable pairs, and the induced map
TV(Sec(q)) â†’ SP is finite, with image the closure Q âŠ‚ SP.
Remark 8.14. Here is what we believe to be the connection between the conjectural construction
above, and the mirror construction we use in this paper: Let Y be Fano, and (X, E) mirror to
(Y, D). For simplicity let us assume both are smooth (e.g. when (Y, D) is a smooth del Pezzo with a
cycle of (âˆ’1)-curves). Then (conjecturally) V := X \ E occurs as a fiber of the mirror family (from
[24]) over TV(Nef(Y )), say over v âˆˆ TPic(Y ) . Let Gm âŠ‚ A1 âŠ‚ TV(Nef(Y )) be the orbit closure of v
for the subgroup Gm of the boundary torus action (see [24, Â§16]) corresponding to âˆ’KY . We expect
that the restriction of the mirror family V â†’ A1 is K X â†’ A1 (as in Notation 2.21). Note K â†’ K
bH as
gives a crepant resolution. This restriction is deformation equivalent to the restriction to Spf R
in the first step of the conjectural construction, so we expect the mirror family we construct in this
paper is a special case of the family from the second step of the conjectural construction above.
References
[1] Valery Alexeev. Moduli spaces Mg,n (W ) for surfaces. In Higher-dimensional complex varieties (Trento, 1994),
pages 1â€“22. de Gruyter, Berlin, 1996.
[2] Valery Alexeev. Complete moduli in the presence of semiabelian group action. Ann. of Math. (2), 155(3):611â€“708,
2002.
[3] Victor V. Batyrev. Dual polyhedra and mirror symmetry for Calabi-Yau hypersurfaces in toric varieties. J.
Algebraic Geom., 3(3):493â€“535, 1994.
[4] Vladimir G. Berkovich. Spectral theory and analytic geometry over non-Archimedean fields, volume 33 of
Mathematical Surveys and Monographs. American Mathematical Society, Providence, RI, 1990.
[5] Vladimir G. Berkovich. Vanishing cycles for formal schemes. Invent. Math., 115(3):539â€“571, 1994.
[6] Caucher Birkar, Paolo Cascini, Christopher D. Hacon, and James McKernan. Existence of minimal models for
varieties of log general type. J. Amer. Math. Soc., 23(2):405â€“468, 2010.
[7] Antoine Ducros. La structure des courbes analytiques. En cours de rÃ©daction, date du 15/11/2012.
[8] Jean Fresnel and Marius van der Put. Rigid analytic geometry and its applications, volume 218 of Progress in
Mathematics. BirkhÃ¤user Boston, Inc., Boston, MA, 2004.
[9] William Fulton. Introduction to toric varieties, volume 131 of Annals of Mathematics Studies. Princeton University
Press, Princeton, NJ, 1993. The William H. Roever Lectures in Geometry.

SECONDARY FAN, THETA FUNCTIONS AND MODULI OF CALABI-YAU PAIRS

39

[10] William Fulton. Intersection theory, volume 2 of Ergebnisse der Mathematik und ihrer Grenzgebiete. 3. Folge. A
Series of Modern Surveys in Mathematics. Springer-Verlag, Berlin, second edition, 1998.
[11] I. M. Gelfand, M. M. Kapranov, and A. V. Zelevinsky. Discriminants, resultants, and multidimensional
determinants. Mathematics: Theory & Applications. BirkhÃ¤user Boston, Inc., Boston, MA, 1994.
[12] Mark Gross, Paul Hacking, and Sean Keel. Mirror symmetry for log Calabi-Yau surfaces I. arXiv preprint
arXiv:1106.4977v1, 2011.
[13] Mark Gross, Paul Hacking, and Sean Keel. Mirror symmetry for log Calabi-Yau surfaces I. Publ. Math. Inst.
Hautes Ã‰tudes Sci., 122:65â€“168, 2015.
[14] Mark Gross, Paul Hacking, and Sean Keel. Moduli of surfaces with an anti-canonical cycle. Compos. Math.,
151(2):265â€“291, 2015.
[15] Mark Gross, Paul Hacking, Sean Keel, and Bernd Siebert. Theta functions for K3 surfaces. preprint, 2018.
[16] Mark Gross and Bernd Siebert. Mirror symmetry via logarithmic degeneration data. I. J. Differential Geom.,
72(2):169â€“338, 2006.
[17] Mark Gross and Bernd Siebert. Intrinsic mirror symmetry and punctured Gromov-Witten invariants. In Algebraic
geometry: Salt Lake City 2015, volume 97 of Proc. Sympos. Pure Math., pages 199â€“230. Amer. Math. Soc.,
Providence, RI, 2018.
[18] Mark Gross and Bernd Siebert. Intrinsic mirror symmetry. arXiv preprint arXiv:1909.07649, 2019.
[19] A. Grothendieck. Ã‰lÃ©ments de gÃ©omÃ©trie algÃ©brique. IV. Ã‰tude locale des schÃ©mas et des morphismes de schÃ©mas.
II. Inst. Hautes Ã‰tudes Sci. Publ. Math., (24):231, 1965.
[20] Allen Hatcher. Algebraic topology. Cambridge University Press, Cambridge, 2002.
[21] Yi Hu and Sean Keel. Mori dream spaces and GIT. volume 48, pages 331â€“348. 2000. Dedicated to William Fulton
on the occasion of his 60th birthday.
[22] M. M. Kapranov, B. Sturmfels, and A. V. Zelevinsky. Quotients of toric varieties. Math. Ann., 290(4):643â€“655,
1991.
[23] Sean Keel and Jenia Tevelev. Geometry of Chow quotients of Grassmannians. Duke Math. J., 134(2):259â€“311,
2006.
[24] Sean Keel and Tony Yue Yu. The Frobenius structure theorem for affine log Calabi-Yau varieties containing a
torus. arXiv preprint arXiv:1908.09861, 2019.
[25] J. KollÃ¡r and N. I. Shepherd-Barron. Threefolds and deformations of surface singularities. Invent. Math.,
91(2):299â€“338, 1988.
[26] JÃ¡nos KollÃ¡r. Moduli of varieties of general type. In Handbook of moduli. Vol. II, volume 25 of Adv. Lect. Math.
(ALM), pages 131â€“157. Int. Press, Somerville, MA, 2013.
[27] JÃ¡nos KollÃ¡r. Singularities of the minimal model program, volume 200 of Cambridge Tracts in Mathematics.
Cambridge University Press, Cambridge, 2013. With a collaboration of SÃ¡ndor KovÃ¡cs.
[28] JÃ¡nos KollÃ¡r and SÃ¡ndor J. KovÃ¡cs. Log canonical singularities are Du Bois. J. Amer. Math. Soc., 23(3):791â€“813,
2010.
[29] JÃ¡nos KollÃ¡r and Shigefumi Mori. Birational geometry of algebraic varieties, volume 134 of Cambridge Tracts in
Mathematics. Cambridge University Press, Cambridge, 1998. With the collaboration of C. H. Clemens and A.
Corti, Translated from the 1998 Japanese original.
[30] Eduard Looijenga. Rational surfaces with an anticanonical cycle. Ann. of Math. (2), 114(2):267â€“322, 1981.
[31] Travis Mandel. Theta bases and log Gromov-Witten invariants of cluster varieties. arXiv preprint
arXiv:1903.03042, 2019.
[32] Ezra Miller and Bernd Sturmfels. Combinatorial commutative algebra, volume 227 of Graduate Texts in
Mathematics. Springer-Verlag, New York, 2005.
[33] Isao Naruki. Cross ratio variety as a moduli space of cubic surfaces. Proc. London Math. Soc. (3), 45(1):1â€“30,
1982. With an appendix by Eduard Looijenga.
[34] Johannes Nicaise, Chenyang Xu, and Tony Yue Yu. The non-archimedean SYZ fibration. Compos. Math.,
155(5):953â€“972, 2019.
[35] M. Serhiyenko, Sherman-Bennett and L. Williams. Cluster structures in schubert varieties in the grassmannian.
arXiv preprint arXiv:1902.00807, 2019.
[36] The Stacks Project Authors. Stacks Project. http://stacks.math.columbia.edu, 2013.
[37] Amaury Thuillier. GÃ©omÃ©trie toroÃ¯dale et gÃ©omÃ©trie analytique non archimÃ©dienne. Application au type
dâ€™homotopie de certains schÃ©mas formels. Manuscripta Math., 123(4):381â€“451, 2007.
[38] Tony Yue Yu. Enumeration of holomorphic cylinders in log Calabiâ€“Yau surfaces. I. Math. Ann., 366(3-4):1649â€“
1675, 2016.

40

PAUL HACKING, SEAN KEEL, AND TONY YUE YU

[39] Tony Yue Yu. Enumeration of holomorphic cylinders in log Calabiâ€“Yau surfaces, II : Positivity, integrality and
the gluing formula. Geom. Topol., 25(1):1â€“46, 2021.
Paul Hacking, Department of Mathematics and Statistics, Lederle Graduate Research Tower, University of Massachusetts, Amherst, MA 01003-9305, USA
Email address: hacking@math.umass.edu
Sean Keel, Department of Mathematics, 1 University Station C1200, Austin, TX 78712-0257, USA
Email address: keel@math.utexas.edu
Tony Yue YU, Department of Mathematics M/C 253-37, California Institute of Technology, 1200 E
California Blvd, Pasadena, CA 91125, USA
Email address: yuyuetony@gmail.com

